<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>School ERP - Offline Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <style>
        /* ===== CSS Variables ===== */
        :root {
            --primary-color: #4a6fa5;
            --primary-dark: #385d8a;
            --primary-light: #6b8cbc;
            --secondary-color: #66bb6a;
            --danger-color: #f44336;
            --warning-color: #ff9800;
            --info-color: #2196f3;
            --success-color: #4caf50;
            
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-light: #888888;
            
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-sidebar: #2c3e50;
            --bg-header: #ffffff;
            
            --border-color: #e0e0e0;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 5px 20px rgba(0, 0, 0, 0.15);
            
            --sidebar-width: 250px;
            --sidebar-collapsed-width: 70px;
            --header-height: 70px;
            
            --border-radius: 8px;
            --border-radius-sm: 4px;
            
            --transition: all 0.3s ease;
        }

        /* Dark mode variables */
        .dark-mode {
            --primary-color: #5d8cc7;
            --primary-dark: #4a6fa5;
            --primary-light: #7a9fd6;
            
            --text-primary: #f0f0f0;
            --text-secondary: #cccccc;
            --text-light: #aaaaaa;
            
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --bg-sidebar: #1a252f;
            --bg-header: #1e1e1e;
            
            --border-color: #333333;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 5px 20px rgba(0, 0, 0, 0.4);
        }

        /* ===== Base Styles ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition);
            overflow-x: hidden;
        }

        /* ===== Lock Screen ===== */
        .lock-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        .lock-container {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 3rem;
            border-radius: var(--border-radius);
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-lg);
        }

        .lock-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            color: white;
        }

        .lock-container h2 {
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .lock-container p {
            margin-bottom: 1.5rem;
            opacity: 0.9;
        }

        .pin-input input {
            width: 100%;
            padding: 1rem;
            font-size: 1.5rem;
            text-align: center;
            border: none;
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.9);
            margin-bottom: 1.5rem;
            letter-spacing: 0.5rem;
        }

        .pin-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .note {
            font-size: 0.8rem;
            margin-top: 1.5rem;
            opacity: 0.8;
        }

        /* ===== Main App Container ===== */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* ===== Header ===== */
        .app-header {
            height: var(--header-height);
            background-color: var(--bg-header);
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: var(--transition);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-primary);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .sidebar-toggle:hover {
            background-color: var(--bg-primary);
        }

        .school-info h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .school-info p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .datetime {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
        }

        .icon-btn {
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .icon-btn:hover {
            background-color: var(--bg-primary);
            color: var(--primary-color);
        }

        /* ===== Sidebar ===== */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-sidebar);
            color: white;
            display: flex;
            flex-direction: column;
            position: fixed;
            top: var(--header-height);
            left: 0;
            height: calc(100vh - var(--header-height));
            transition: var(--transition);
            z-index: 99;
            box-shadow: var(--shadow);
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed-width);
        }

        .sidebar-nav {
            flex: 1;
            padding: 1.5rem 0;
            overflow-y: auto;
        }

        .sidebar-nav ul {
            list-style: none;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--primary-light);
        }

        .nav-link.active {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            border-left-color: var(--primary-color);
        }

        .nav-link i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .sidebar.collapsed .nav-link span {
            display: none;
        }

        .sidebar-footer {
            padding: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.8rem;
        }

        .storage-info {
            margin-bottom: 1rem;
        }

        .storage-bar {
            height: 6px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .storage-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 30%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .offline-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.7);
        }

        /* ===== Main Content ===== */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 1.5rem;
            overflow-y: auto;
            transition: var(--transition);
            background-color: var(--bg-primary);
        }

        .sidebar.collapsed + .main-content {
            margin-left: var(--sidebar-collapsed-width);
        }

        /* ===== Page Styles ===== */
        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .page-actions {
            display: flex;
            gap: 1rem;
        }

        /* ===== Buttons ===== */
        .btn {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--bg-primary);
            border-color: var(--primary-color);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #3d8b40;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #f57c00;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
        }

        /* ===== Cards ===== */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border-color);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .card-icon.students { background-color: #4a6fa5; }
        .card-icon.teachers { background-color: #66bb6a; }
        .card-icon.classes { background-color: #ff9800; }
        .card-icon.attendance { background-color: #2196f3; }
        .card-icon.fees { background-color: #9c27b0; }
        .card-icon.notices { background-color: #f44336; }

        .card-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .card-change {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .card-change.positive { color: var(--success-color); }
        .card-change.negative { color: var(--danger-color); }

        /* ===== Tables ===== */
        .table-container {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .table-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .table-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 0.7rem 1rem 0.7rem 2.5rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            width: 250px;
            transition: var(--transition);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        thead {
            background-color: var(--bg-primary);
            border-bottom: 2px solid var(--border-color);
        }

        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        tbody tr {
            transition: var(--transition);
        }

        tbody tr:hover {
            background-color: var(--bg-primary);
        }

        /* ===== Badges ===== */
        .badge {
            display: inline-block;
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-success {
            background-color: rgba(76, 175, 80, 0.15);
            color: var(--success-color);
        }

        .badge-danger {
            background-color: rgba(244, 67, 54, 0.15);
            color: var(--danger-color);
        }

        .badge-warning {
            background-color: rgba(255, 152, 0, 0.15);
            color: var(--warning-color);
        }

        .badge-info {
            background-color: rgba(33, 150, 243, 0.15);
            color: var(--info-color);
        }

        .badge-primary {
            background-color: rgba(74, 111, 165, 0.15);
            color: var(--primary-color);
        }

        /* ===== Modals ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .modal {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background-color: var(--bg-primary);
            color: var(--danger-color);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* ===== Forms ===== */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
        }

        .form-row {
            display: flex;
            gap: 1rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        /* ===== Toast Notifications ===== */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .toast {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideInRight 0.3s ease;
            border-left: 4px solid var(--primary-color);
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success {
            border-left-color: var(--success-color);
        }

        .toast.error {
            border-left-color: var(--danger-color);
        }

        .toast.warning {
            border-left-color: var(--warning-color);
        }

        .toast.info {
            border-left-color: var(--info-color);
        }

        .toast-icon {
            font-size: 1.5rem;
        }

        .toast.success .toast-icon { color: var(--success-color); }
        .toast.error .toast-icon { color: var(--danger-color); }
        .toast.warning .toast-icon { color: var(--warning-color); }
        .toast.info .toast-icon { color: var(--info-color); }

        .toast-message {
            flex: 1;
            font-weight: 500;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* ===== Profile Page ===== */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            padding: 2rem;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            font-weight: 700;
        }

        .profile-info h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .profile-info p {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .profile-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .tab-btn {
            padding: 1rem 2rem;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .tab-btn:hover {
            color: var(--primary-color);
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* ===== Attendance Grid ===== */
        .attendance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .attendance-card {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid transparent;
        }

        .attendance-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .attendance-card.present {
            border-color: var(--success-color);
        }

        .attendance-card.absent {
            border-color: var(--danger-color);
        }

        .attendance-card.selected.present {
            background-color: rgba(76, 175, 80, 0.1);
        }

        .attendance-card.selected.absent {
            background-color: rgba(244, 67, 54, 0.1);
        }

        .attendance-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            margin-bottom: 0.5rem;
        }

        .attendance-name {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .attendance-status {
            font-size: 0.8rem;
            padding: 0.2rem 0.5rem;
            border-radius: 20px;
        }

        /* ===== Timetable ===== */
        .timetable {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .timetable th {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
        }

        .timetable td {
            padding: 1rem;
            border: 1px solid var(--border-color);
            text-align: center;
            vertical-align: top;
        }

        .timetable-period {
            font-weight: 600;
            color: var(--primary-color);
        }

        .timetable-subject {
            font-weight: 500;
            margin-bottom: 0.3rem;
            color: var(--text-primary);
        }

        .timetable-teacher {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* ===== Notice Board ===== */
        .notices-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .notice-card {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary-color);
            transition: var(--transition);
        }

        .notice-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .notice-card.important {
            border-left-color: var(--danger-color);
        }

        .notice-card.warning {
            border-left-color: var(--warning-color);
        }

        .notice-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .notice-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .notice-date {
            font-size: 0.9rem;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .notice-content {
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* ===== Settings Page ===== */
        .settings-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }

        .settings-nav {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            height: fit-content;
        }

        .settings-nav ul {
            list-style: none;
        }

        .settings-nav li {
            margin-bottom: 0.5rem;
        }

        .settings-nav a {
            display: block;
            padding: 0.8rem 1rem;
            color: var(--text-primary);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .settings-nav a:hover {
            background-color: var(--bg-primary);
        }

        .settings-nav a.active {
            background-color: var(--primary-color);
            color: white;
        }

        .settings-content {
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
        }

        /* ===== Pagination ===== */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .pagination-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .pagination-btn:hover:not(:disabled) {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-pages {
            display: flex;
            gap: 0.3rem;
        }

        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .page-btn:hover {
            background-color: var(--bg-primary);
        }

        .page-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* ===== Fee Structure ===== */
        .fee-structure-table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .fee-structure-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: left;
        }

        .fee-structure-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .fee-amount {
            font-weight: 600;
            color: var(--primary-color);
        }

        /* ===== Exam Results ===== */
        .exam-results-table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--bg-secondary);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .exam-results-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: left;
        }

        .exam-results-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .result-grade {
            font-weight: 600;
            padding: 0.3rem 0.7rem;
            border-radius: 20px;
        }

        .grade-a { background-color: rgba(76, 175, 80, 0.15); color: var(--success-color); }
        .grade-b { background-color: rgba(33, 150, 243, 0.15); color: var(--info-color); }
        .grade-c { background-color: rgba(255, 152, 0, 0.15); color: var(--warning-color); }
        .grade-d { background-color: rgba(244, 67, 54, 0.15); color: var(--danger-color); }
        .grade-f { background-color: rgba(158, 158, 158, 0.15); color: var(--text-secondary); }

        /* ===== Responsive ===== */
        @media (max-width: 992px) {
            .settings-container {
                grid-template-columns: 1fr;
            }
            
            .cards-container {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: var(--sidebar-width);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0 !important;
            }
            
            .header-right {
                gap: 1rem;
            }
            
            .school-info h1 {
                font-size: 1.2rem;
            }
            
            .search-box input {
                width: 200px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .attendance-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }

        @media (max-width: 576px) {
            .app-header {
                padding: 0 1rem;
            }
            
            .header-right {
                flex-direction: column;
                align-items: flex-end;
                gap: 0.5rem;
            }
            
            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .table-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .table-controls {
                width: 100%;
            }
            
            .search-box input {
                width: 100%;
            }
            
            .modal {
                width: 95%;
                margin: 1rem;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .cards-container {
                grid-template-columns: 1fr;
            }
            
            .attendance-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body class="light-mode">
    <!-- PIN Lock Screen -->
    <div id="lockScreen" class="lock-screen" style="display: none;">
        <div class="lock-container">
            <div class="lock-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h2>School ERP - Secure Access</h2>
            <p>Enter PIN to access the system</p>
            <div class="pin-input">
                <input type="password" id="pinField" maxlength="4" placeholder="Enter 4-digit PIN">
            </div>
            <div class="pin-buttons">
                <button class="btn-primary" id="unlockBtn">Unlock</button>
                <button class="btn-secondary" id="resetPinBtn">Reset PIN</button>
            </div>
            <p class="note">Default PIN: 1234 (You can change it in Settings)</p>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <button class="sidebar-toggle" id="sidebarToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="school-info">
                    <h1 id="schoolName">Greenwood High School</h1>
                    <p id="academicYear">Academic Year: 2023-2024</p>
                </div>
            </div>
            <div class="header-right">
                <div class="datetime" id="currentDateTime">
                    <!-- Will be updated by JS -->
                </div>
                <div class="header-actions">
                    <button class="icon-btn" id="themeToggle" title="Toggle Dark Mode">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="icon-btn" id="exportBtn" title="Export Data">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="icon-btn" id="importBtn" title="Import Data">
                        <i class="fas fa-upload"></i>
                    </button>
                    <button class="icon-btn" id="settingsBtn" title="Settings">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button class="icon-btn" id="lockBtn" title="Lock System">
                        <i class="fas fa-lock"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="#dashboard" class="nav-link active" data-page="dashboard">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#students" class="nav-link" data-page="students">
                            <i class="fas fa-user-graduate"></i>
                            <span>Students</span>
                        </a>
                    </li>
                    <li>
                        <a href="#teachers" class="nav-link" data-page="teachers">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <span>Teachers</span>
                        </a>
                    </li>
                    <li>
                        <a href="#classes" class="nav-link" data-page="classes">
                            <i class="fas fa-school"></i>
                            <span>Classes</span>
                        </a>
                    </li>
                    <li>
                        <a href="#attendance" class="nav-link" data-page="attendance">
                            <i class="fas fa-clipboard-check"></i>
                            <span>Attendance</span>
                        </a>
                    </li>
                    <li>
                        <a href="#exams" class="nav-link" data-page="exams">
                            <i class="fas fa-file-alt"></i>
                            <span>Exams & Results</span>
                        </a>
                    </li>
                    <li>
                        <a href="#fees" class="nav-link" data-page="fees">
                            <i class="fas fa-money-check-alt"></i>
                            <span>Fee Management</span>
                        </a>
                    </li>
                    <li>
                        <a href="#timetable" class="nav-link" data-page="timetable">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Timetable</span>
                        </a>
                    </li>
                    <li>
                        <a href="#notices" class="nav-link" data-page="notices">
                            <i class="fas fa-bullhorn"></i>
                            <span>Notice Board</span>
                        </a>
                    </li>
                    <li>
                        <a href="#settings" class="nav-link" data-page="settings">
                            <i class="fas fa-cogs"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <div class="storage-info">
                    <div class="storage-bar">
                        <div class="storage-fill" id="storageFill"></div>
                    </div>
                    <small>Local Storage: <span id="storageUsed">0</span> KB used</small>
                </div>
                <div class="offline-status">
                    <i class="fas fa-wifi-slash"></i>
                    <span>Offline Mode</span>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content" id="mainContent">
            <!-- Pages will be dynamically loaded here -->
            <div class="page active" id="dashboardPage"></div>
            <div class="page" id="studentsPage"></div>
            <div class="page" id="teachersPage"></div>
            <div class="page" id="classesPage"></div>
            <div class="page" id="attendancePage"></div>
            <div class="page" id="examsPage"></div>
            <div class="page" id="feesPage"></div>
            <div class="page" id="timetablePage"></div>
            <div class="page" id="noticesPage"></div>
            <div class="page" id="settingsPage"></div>
        </main>

        <!-- Modals will be appended here dynamically -->
        <div id="modalContainer"></div>

        <!-- Toast notifications -->
        <div id="toastContainer" class="toast-container"></div>
    </div>

    <script>
        // ============================================
        // Storage Management System
        // ============================================
        class SchoolERPStorage {
            constructor() {
                this.initStorage();
            }
            
            initStorage() {
                // Initialize all storage keys with default values if they don't exist
                const defaults = {
                    settings: {
                        schoolName: "Greenwood High School",
                        academicYear: "2023-2024",
                        theme: "light",
                        pin: "1234"
                    },
                    students: [],
                    teachers: [],
                    classes: [],
                    subjects: [],
                    attendance: [],
                    exams: [],
                    results: [],
                    fees: [],
                    feeStructure: [],
                    timetable: [],
                    notices: []
                };
                
                for (const [key, value] of Object.entries(defaults)) {
                    if (!this.get(key)) {
                        this.set(key, value);
                    }
                }
                
                // Initialize sample data
                this.initSampleData();
                
                // Update storage usage display
                this.updateStorageUsage();
            }
            
            get(key) {
                try {
                    const item = localStorage.getItem(`schoolERP_${key}`);
                    return item ? JSON.parse(item) : null;
                } catch (error) {
                    console.error(`Error getting ${key} from storage:`, error);
                    return null;
                }
            }
            
            set(key, value) {
                try {
                    localStorage.setItem(`schoolERP_${key}`, JSON.stringify(value));
                    this.updateStorageUsage();
                    return true;
                } catch (error) {
                    console.error(`Error setting ${key} in storage:`, error);
                    this.showStorageError();
                    return false;
                }
            }
            
            updateStorageUsage() {
                let totalBytes = 0;
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('schoolERP_')) {
                        totalBytes += localStorage.getItem(key).length * 2; // Approximate bytes
                    }
                }
                
                const usedKB = Math.round(totalBytes / 1024);
                const maxKB = 5120; // 5MB typical localStorage limit
                const percentage = Math.min((usedKB / maxKB) * 100, 100);
                
                // Update UI
                const fillElement = document.getElementById('storageFill');
                const usedElement = document.getElementById('storageUsed');
                
                if (fillElement) {
                    fillElement.style.width = `${percentage}%`;
                }
                
                if (usedElement) {
                    usedElement.textContent = usedKB;
                }
                
                // Change color based on usage
                if (fillElement) {
                    if (percentage > 90) {
                        fillElement.style.backgroundColor = 'var(--danger-color)';
                    } else if (percentage > 70) {
                        fillElement.style.backgroundColor = 'var(--warning-color)';
                    } else {
                        fillElement.style.backgroundColor = 'var(--primary-color)';
                    }
                }
            }
            
            showStorageError() {
                const toast = {
                    type: 'error',
                    message: 'Storage is full! Please export your data and clear browser data.',
                    duration: 5000
                };
                if (window.showToast) {
                    window.showToast(toast);
                }
            }
            
            exportData() {
                const data = {};
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith('schoolERP_')) {
                        const cleanKey = key.replace('schoolERP_', '');
                        data[cleanKey] = JSON.parse(localStorage.getItem(key));
                    }
                }
                
                data.exportDate = new Date().toISOString();
                data.appVersion = "1.0.0";
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `school-erp-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                return true;
            }
            
            importData(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            
                            // Validate the imported data
                            if (!data.settings || !data.students) {
                                throw new Error('Invalid backup file format');
                            }
                            
                            // Clear existing data
                            for (let i = 0; i < localStorage.length; i++) {
                                const key = localStorage.key(i);
                                if (key.startsWith('schoolERP_')) {
                                    localStorage.removeItem(key);
                                }
                            }
                            
                            // Import new data
                            for (const [key, value] of Object.entries(data)) {
                                this.set(key, value);
                            }
                            
                            resolve(true);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    reader.onerror = () => reject(new Error('Failed to read file'));
                    reader.readAsText(file);
                });
            }
            
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
            
            // Student methods
            getStudents() {
                return this.get('students') || [];
            }
            
            saveStudent(student) {
                const students = this.getStudents();
                if (student.id) {
                    // Update existing student
                    const index = students.findIndex(s => s.id === student.id);
                    if (index !== -1) {
                        students[index] = student;
                    }
                } else {
                    // Add new student
                    student.id = this.generateId();
                    student.admissionNo = student.admissionNo || `STU${String(students.length + 1).padStart(4, '0')}`;
                    student.createdAt = new Date().toISOString();
                    students.push(student);
                }
                
                this.set('students', students);
                return student;
            }
            
            deleteStudent(id) {
                const students = this.getStudents();
                const filtered = students.filter(s => s.id !== id);
                this.set('students', filtered);
                return true;
            }
            
            // Teacher methods
            getTeachers() {
                return this.get('teachers') || [];
            }
            
            saveTeacher(teacher) {
                const teachers = this.getTeachers();
                if (teacher.id) {
                    const index = teachers.findIndex(t => t.id === teacher.id);
                    if (index !== -1) {
                        teachers[index] = teacher;
                    }
                } else {
                    teacher.id = this.generateId();
                    teacher.employeeId = teacher.employeeId || `TCH${String(teachers.length + 1).padStart(4, '0')}`;
                    teacher.createdAt = new Date().toISOString();
                    teachers.push(teacher);
                }
                
                this.set('teachers', teachers);
                return teacher;
            }
            
            deleteTeacher(id) {
                const teachers = this.getTeachers();
                const filtered = teachers.filter(t => t.id !== id);
                this.set('teachers', filtered);
                return true;
            }
            
            // Class methods
            getClasses() {
                return this.get('classes') || [];
            }
            
            saveClass(cls) {
                const classes = this.getClasses();
                if (cls.id) {
                    const index = classes.findIndex(c => c.id === cls.id);
                    if (index !== -1) {
                        classes[index] = cls;
                    }
                } else {
                    cls.id = this.generateId();
                    cls.createdAt = new Date().toISOString();
                    classes.push(cls);
                }
                
                this.set('classes', classes);
                return cls;
            }
            
            deleteClass(id) {
                const classes = this.getClasses();
                const filtered = classes.filter(c => c.id !== id);
                this.set('classes', filtered);
                return true;
            }
            
            // Subject methods
            getSubjects() {
                return this.get('subjects') || [];
            }
            
            saveSubject(subject) {
                const subjects = this.getSubjects();
                if (subject.id) {
                    const index = subjects.findIndex(s => s.id === subject.id);
                    if (index !== -1) {
                        subjects[index] = subject;
                    }
                } else {
                    subject.id = this.generateId();
                    subject.createdAt = new Date().toISOString();
                    subjects.push(subject);
                }
                
                this.set('subjects', subjects);
                return subject;
            }
            
            deleteSubject(id) {
                const subjects = this.getSubjects();
                const filtered = subjects.filter(s => s.id !== id);
                this.set('subjects', filtered);
                return true;
            }
            
            // Attendance methods
            getAttendance() {
                return this.get('attendance') || [];
            }
            
            getAttendanceByDate(date) {
                const allAttendance = this.getAttendance();
                return allAttendance.find(a => a.date === date && a.class === this.currentClass && a.section === this.currentSection);
            }
            
            saveAttendance(attendance) {
                const allAttendance = this.getAttendance();
                attendance.id = attendance.id || this.generateId();
                attendance.date = attendance.date || new Date().toISOString().split('T')[0];
                attendance.createdAt = new Date().toISOString();
                
                // Remove existing attendance for same date, class, and section
                const filtered = allAttendance.filter(a => 
                    !(a.date === attendance.date && 
                      a.class === attendance.class && 
                      a.section === attendance.section)
                );
                
                filtered.push(attendance);
                this.set('attendance', filtered);
                return attendance;
            }
            
            // Exam methods
            getExams() {
                return this.get('exams') || [];
            }
            
            saveExam(exam) {
                const exams = this.getExams();
                if (exam.id) {
                    const index = exams.findIndex(e => e.id === exam.id);
                    if (index !== -1) {
                        exams[index] = exam;
                    }
                } else {
                    exam.id = this.generateId();
                    exam.createdAt = new Date().toISOString();
                    exams.push(exam);
                }
                
                this.set('exams', exams);
                return exam;
            }
            
            deleteExam(id) {
                const exams = this.getExams();
                const filtered = exams.filter(e => e.id !== id);
                this.set('exams', filtered);
                return true;
            }
            
            // Result methods
            getResults() {
                return this.get('results') || [];
            }
            
            saveResult(result) {
                const results = this.getResults();
                if (result.id) {
                    const index = results.findIndex(r => r.id === result.id);
                    if (index !== -1) {
                        results[index] = result;
                    }
                } else {
                    result.id = this.generateId();
                    result.createdAt = new Date().toISOString();
                    results.push(result);
                }
                
                this.set('results', results);
                return result;
            }
            
            // Fee methods
            getFees() {
                return this.get('fees') || [];
            }
            
            saveFee(fee) {
                const fees = this.getFees();
                if (fee.id) {
                    const index = fees.findIndex(f => f.id === fee.id);
                    if (index !== -1) {
                        fees[index] = fee;
                    }
                } else {
                    fee.id = this.generateId();
                    fee.createdAt = new Date().toISOString();
                    fees.push(fee);
                }
                
                this.set('fees', fees);
                return fee;
            }
            
            deleteFee(id) {
                const fees = this.getFees();
                const filtered = fees.filter(f => f.id !== id);
                this.set('fees', filtered);
                return true;
            }
            
            // Fee structure methods
            getFeeStructure() {
                return this.get('feeStructure') || [];
            }
            
            saveFeeStructure(feeStructure) {
                const structures = this.getFeeStructure();
                if (feeStructure.id) {
                    const index = structures.findIndex(f => f.id === feeStructure.id);
                    if (index !== -1) {
                        structures[index] = feeStructure;
                    }
                } else {
                    feeStructure.id = this.generateId();
                    feeStructure.createdAt = new Date().toISOString();
                    structures.push(feeStructure);
                }
                
                this.set('feeStructure', structures);
                return feeStructure;
            }
            
            deleteFeeStructure(id) {
                const structures = this.getFeeStructure();
                const filtered = structures.filter(f => f.id !== id);
                this.set('feeStructure', filtered);
                return true;
            }
            
            // Timetable methods
            getTimetable() {
                return this.get('timetable') || [];
            }
            
            saveTimetable(timetable) {
                const timetables = this.getTimetable();
                if (timetable.id) {
                    const index = timetables.findIndex(t => t.id === timetable.id);
                    if (index !== -1) {
                        timetables[index] = timetable;
                    }
                } else {
                    timetable.id = this.generateId();
                    timetable.createdAt = new Date().toISOString();
                    timetables.push(timetable);
                }
                
                this.set('timetable', timetables);
                return timetable;
            }
            
            deleteTimetable(id) {
                const timetables = this.getTimetable();
                const filtered = timetables.filter(t => t.id !== id);
                this.set('timetable', filtered);
                return true;
            }
            
            // Notice methods
            getNotices() {
                return this.get('notices') || [];
            }
            
            saveNotice(notice) {
                const notices = this.getNotices();
                if (notice.id) {
                    const index = notices.findIndex(n => n.id === notice.id);
                    if (index !== -1) {
                        notices[index] = notice;
                    }
                } else {
                    notice.id = this.generateId();
                    notice.date = new Date().toISOString();
                    notice.createdAt = new Date().toISOString();
                    notices.unshift(notice); // Add to beginning
                }
                
                this.set('notices', notices);
                return notice;
            }
            
            deleteNotice(id) {
                const notices = this.getNotices();
                const filtered = notices.filter(n => n.id !== id);
                this.set('notices', filtered);
                return true;
            }
            
            // Initialize sample data
            initSampleData() {
                const students = this.getStudents();
                const teachers = this.getTeachers();
                const classes = this.getClasses();
                const subjects = this.getSubjects();
                const feeStructure = this.getFeeStructure();
                const exams = this.getExams();
                const timetable = this.getTimetable();
                
                // Add sample students if empty
                if (students.length === 0) {
                    const sampleStudents = [
                        {
                            id: 'stu1',
                            admissionNo: 'STU001',
                            name: 'John Smith',
                            class: '10',
                            section: 'A',
                            rollNo: '1',
                            gender: 'Male',
                            dob: '2007-05-15',
                            parentName: 'Michael Smith',
                            phone: '555-0101',
                            address: '123 Main Street, City',
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: 'stu2',
                            admissionNo: 'STU002',
                            name: 'Emma Johnson',
                            class: '10',
                            section: 'A',
                            rollNo: '2',
                            gender: 'Female',
                            dob: '2007-08-22',
                            parentName: 'Sarah Johnson',
                            phone: '555-0102',
                            address: '456 Oak Avenue, City',
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: 'stu3',
                            admissionNo: 'STU003',
                            name: 'David Wilson',
                            class: '9',
                            section: 'B',
                            rollNo: '1',
                            gender: 'Male',
                            dob: '2008-03-10',
                            parentName: 'Robert Wilson',
                            phone: '555-0103',
                            address: '789 Pine Road, City',
                            createdAt: new Date().toISOString()
                        }
                    ];
                    
                    sampleStudents.forEach(student => this.saveStudent(student));
                }
                
                // Add sample teachers if empty
                if (teachers.length === 0) {
                    const sampleTeachers = [
                        {
                            id: 'tch1',
                            employeeId: 'TCH001',
                            name: 'Dr. Robert Miller',
                            email: 'robert.miller@school.edu',
                            phone: '555-0201',
                            subject: 'Mathematics',
                            classes: ['10', '11', '12'],
                            qualification: 'PhD in Mathematics',
                            experience: '15 years',
                            joinedDate: '2010-06-01'
                        },
                        {
                            id: 'tch2',
                            employeeId: 'TCH002',
                            name: 'Ms. Jennifer Taylor',
                            email: 'jennifer.taylor@school.edu',
                            phone: '555-0202',
                            subject: 'English Literature',
                            classes: ['9', '10', '11'],
                            qualification: 'MA in English',
                            experience: '10 years',
                            joinedDate: '2015-08-15'
                        }
                    ];
                    
                    sampleTeachers.forEach(teacher => this.saveTeacher(teacher));
                }
                
                // Add sample classes if empty
                if (classes.length === 0) {
                    const sampleClasses = [
                        { id: 'cls1', name: 'Class 10', sections: ['A', 'B', 'C'], subjects: ['Math', 'Science', 'English'] },
                        { id: 'cls2', name: 'Class 9', sections: ['A', 'B'], subjects: ['Math', 'Science', 'English', 'Social'] },
                        { id: 'cls3', name: 'Class 8', sections: ['A', 'B', 'C'], subjects: ['Math', 'Science', 'English'] }
                    ];
                    
                    sampleClasses.forEach(cls => this.saveClass(cls));
                }
                
                // Add sample subjects if empty
                if (subjects.length === 0) {
                    const sampleSubjects = [
                        { id: 'sub1', name: 'Mathematics', code: 'MATH101', teacher: 'Dr. Robert Miller' },
                        { id: 'sub2', name: 'Science', code: 'SCI101', teacher: 'Dr. Sarah Johnson' },
                        { id: 'sub3', name: 'English', code: 'ENG101', teacher: 'Ms. Jennifer Taylor' }
                    ];
                    
                    sampleSubjects.forEach(subject => this.saveSubject(subject));
                }
                
                // Add sample fee structure if empty
                if (feeStructure.length === 0) {
                    const sampleFeeStructure = [
                        { id: 'fee1', class: '10', term: 'Annual', amount: 50000, description: 'Annual Fee' },
                        { id: 'fee2', class: '9', term: 'Annual', amount: 45000, description: 'Annual Fee' },
                        { id: 'fee3', class: '8', term: 'Annual', amount: 40000, description: 'Annual Fee' }
                    ];
                    
                    sampleFeeStructure.forEach(fee => this.saveFeeStructure(fee));
                }
                
                // Add sample exams if empty
                if (exams.length === 0) {
                    const sampleExams = [
                        { id: 'exam1', name: 'Unit Test 1', class: '10', subject: 'Mathematics', date: '2024-04-15', maxMarks: 100 },
                        { id: 'exam2', name: 'Unit Test 1', class: '10', subject: 'Science', date: '2024-04-16', maxMarks: 100 }
                    ];
                    
                    sampleExams.forEach(exam => this.saveExam(exam));
                }
                
                // Add sample timetable if empty
                if (timetable.length === 0) {
                    const sampleTimetable = [
                        { 
                            id: 'tt1', 
                            class: '10', 
                            section: 'A',
                            periods: [
                                { day: 'Monday', period1: 'Math', period2: 'Science', period3: 'English', period4: 'PE', period5: 'History' },
                                { day: 'Tuesday', period1: 'Science', period2: 'Math', period3: 'PE', period4: 'English', period5: 'Geography' }
                            ]
                        }
                    ];
                    
                    sampleTimetable.forEach(tt => this.saveTimetable(tt));
                }
            }
            
            // Get statistics for dashboard
            getDashboardStats() {
                const students = this.getStudents();
                const teachers = this.getTeachers();
                const classes = this.getClasses();
                const attendance = this.getAttendance();
                const fees = this.getFees();
                const notices = this.getNotices();
                
                const today = new Date().toISOString().split('T')[0];
                const todayAttendance = attendance.filter(a => a.date === today);
                const pendingFees = fees.filter(f => f.status === 'pending').length;
                
                return {
                    totalStudents: students.length,
                    totalTeachers: teachers.length,
                    totalClasses: classes.length,
                    todayAttendance: todayAttendance.length,
                    pendingFees: pendingFees,
                    activeNotices: notices.length
                };
            }
        }

        // Create global storage instance
        window.storage = new SchoolERPStorage();

        // ============================================
        // UI Management System
        // ============================================
        class SchoolERPUI {
            constructor() {
                this.currentPage = 'dashboard';
                this.currentAttendance = {
                    date: new Date().toISOString().split('T')[0],
                    class: '',
                    section: '',
                    students: []
                };
                this.initUI();
            }
            
            initUI() {
                this.initEventListeners();
                this.updateDateTime();
                this.loadPage('dashboard');
                this.applyTheme();
                
                // Update datetime every minute
                setInterval(() => this.updateDateTime(), 60000);
            }
            
            initEventListeners() {
                // Sidebar toggle
                document.getElementById('sidebarToggle').addEventListener('click', () => {
                    document.getElementById('sidebar').classList.toggle('collapsed');
                });
                
                // Navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = link.getAttribute('data-page');
                        this.loadPage(page);
                        
                        // Update active nav link
                        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                    });
                });
                
                // Theme toggle
                document.getElementById('themeToggle').addEventListener('click', () => {
                    this.toggleTheme();
                });
                
                // Lock button
                document.getElementById('lockBtn').addEventListener('click', () => {
                    this.lockSystem();
                });
                
                // Export button
                document.getElementById('exportBtn').addEventListener('click', () => {
                    this.showExportModal();
                });
                
                // Import button
                document.getElementById('importBtn').addEventListener('click', () => {
                    this.showImportModal();
                });
                
                // Settings button
                document.getElementById('settingsBtn').addEventListener('click', () => {
                    this.loadPage('settings');
                });
                
                // PIN lock system
                document.getElementById('unlockBtn').addEventListener('click', () => {
                    this.unlockSystem();
                });
                
                document.getElementById('pinField').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.unlockSystem();
                    }
                });
                
                document.getElementById('resetPinBtn').addEventListener('click', () => {
                    this.resetPin();
                });
            }
            
            updateDateTime() {
                const now = new Date();
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                const dateTimeString = now.toLocaleDateString('en-US', options);
                document.getElementById('currentDateTime').textContent = dateTimeString;
            }
            
            applyTheme() {
                const settings = storage.get('settings');
                if (settings.theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
                } else {
                    document.body.classList.remove('dark-mode');
                    document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
                }
            }
            
            toggleTheme() {
                const settings = storage.get('settings');
                settings.theme = settings.theme === 'light' ? 'dark' : 'light';
                storage.set('settings', settings);
                this.applyTheme();
                this.showToast({ type: 'success', message: `Switched to ${settings.theme} mode` });
            }
            
            lockSystem() {
                document.getElementById('lockScreen').style.display = 'flex';
                document.getElementById('appContainer').style.display = 'none';
                document.getElementById('pinField').value = '';
                document.getElementById('pinField').focus();
            }
            
            unlockSystem() {
                const pinInput = document.getElementById('pinField').value;
                const settings = storage.get('settings');
                
                if (pinInput === settings.pin) {
                    document.getElementById('lockScreen').style.display = 'none';
                    document.getElementById('appContainer').style.display = 'flex';
                    this.showToast({ type: 'success', message: 'System unlocked' });
                } else {
                    this.showToast({ type: 'error', message: 'Incorrect PIN' });
                    document.getElementById('pinField').value = '';
                    document.getElementById('pinField').focus();
                }
            }
            
            resetPin() {
                const settings = storage.get('settings');
                settings.pin = '1234';
                storage.set('settings', settings);
                this.showToast({ type: 'success', message: 'PIN reset to 1234' });
                document.getElementById('pinField').value = '';
                document.getElementById('pinField').focus();
            }
            
            loadPage(page) {
                this.currentPage = page;
                
                // Hide all pages
                document.querySelectorAll('.page').forEach(p => {
                    p.classList.remove('active');
                    p.style.display = 'none';
                });
                
                // Show current page
                const pageElement = document.getElementById(`${page}Page`);
                if (pageElement) {
                    pageElement.style.display = 'block';
                    pageElement.classList.add('active');
                    this.loadPageContent(page);
                }
                
                // Update school name and academic year
                const settings = storage.get('settings');
                document.getElementById('schoolName').textContent = settings.schoolName;
                document.getElementById('academicYear').textContent = `Academic Year: ${settings.academicYear}`;
            }
            
            loadPageContent(page) {
                switch(page) {
                    case 'dashboard':
                        this.loadDashboard();
                        break;
                    case 'students':
                        this.loadStudents();
                        break;
                    case 'teachers':
                        this.loadTeachers();
                        break;
                    case 'classes':
                        this.loadClasses();
                        break;
                    case 'attendance':
                        this.loadAttendance();
                        break;
                    case 'exams':
                        this.loadExams();
                        break;
                    case 'fees':
                        this.loadFees();
                        break;
                    case 'timetable':
                        this.loadTimetable();
                        break;
                    case 'notices':
                        this.loadNotices();
                        break;
                    case 'settings':
                        this.loadSettings();
                        break;
                }
            }
            
            loadDashboard() {
                const stats = storage.getDashboardStats();
                const students = storage.getStudents();
                const notices = storage.getNotices();
                
                const html = `
                    <div class="page-header">
                        <h1 class="page-title">Dashboard</h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" id="addStudentBtn">
                                <i class="fas fa-user-plus"></i> Add Student
                            </button>
                            <button class="btn btn-success" id="markAttendanceBtn">
                                <i class="fas fa-clipboard-check"></i> Mark Attendance
                            </button>
                        </div>
                    </div>
                    
                    <div class="cards-container">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Total Students</h3>
                                <div class="card-icon students">
                                    <i class="fas fa-user-graduate"></i>
                                </div>
                            </div>
                            <div class="card-value">${stats.totalStudents}</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up"></i> ${stats.totalStudents} enrolled
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Total Teachers</h3>
                                <div class="card-icon teachers">
                                    <i class="fas fa-chalkboard-teacher"></i>
                                </div>
                            </div>
                            <div class="card-value">${stats.totalTeachers}</div>
                            <div class="card-change positive">
                                <i class="fas fa-arrow-up"></i> ${stats.totalTeachers} active
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Total Classes</h3>
                                <div class="card-icon classes">
                                    <i class="fas fa-school"></i>
                                </div>
                            </div>
                            <div class="card-value">${stats.totalClasses}</div>
                            <div class="card-change">
                                All active
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Today's Attendance</h3>
                                <div class="card-icon attendance">
                                    <i class="fas fa-clipboard-check"></i>
                                </div>
                            </div>
                            <div class="card-value">${stats.todayAttendance}</div>
                            <div class="card-change">
                                ${stats.todayAttendance > 0 ? 'Marked today' : 'Not marked yet'}
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Pending Fees</h3>
                                <div class="card-icon fees">
                                    <i class="fas fa-money-check-alt"></i>
                                </div>
                            </div>
                            <div class="card-value">${stats.pendingFees}</div>
                            <div class="card-change ${stats.pendingFees > 0 ? 'negative' : 'positive'}">
                                ${stats.pendingFees > 0 ? 'Pending collection' : 'All cleared'}
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Active Notices</h3>
                                <div class="card-icon notices">
                                    <i class="fas fa-bullhorn"></i>
                                </div>
                            </div>
                            <div class="card-value">${stats.activeNotices}</div>
                            <div class="card-change">
                                ${stats.activeNotices > 0 ? 'Latest today' : 'No notices'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Recent Students</h3>
                            <div class="table-controls">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="studentSearch" placeholder="Search students...">
                                </div>
                                <button class="btn btn-primary" id="viewAllStudents">
                                    View All
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Admission No</th>
                                        <th>Name</th>
                                        <th>Class</th>
                                        <th>Roll No</th>
                                        <th>Parent</th>
                                        <th>Phone</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="recentStudentsTable">
                                    ${students.slice(0, 5).map(student => `
                                        <tr>
                                            <td>${student.admissionNo}</td>
                                            <td>${student.name}</td>
                                            <td>${student.class} - ${student.section}</td>
                                            <td>${student.rollNo}</td>
                                            <td>${student.parentName}</td>
                                            <td>${student.phone}</td>
                                            <td>
                                                <button class="btn btn-sm btn-secondary" onclick="ui.showStudentProfile('${student.id}')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-sm btn-primary" onclick="ui.showStudentForm('${student.id}')">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Recent Notices</h3>
                            <button class="btn btn-primary" id="addNoticeBtn">
                                <i class="fas fa-plus"></i> Add Notice
                            </button>
                        </div>
                        <div class="notices-list">
                            ${notices.slice(0, 3).map(notice => `
                                <div class="notice-card ${notice.important ? 'important' : ''}">
                                    <div class="notice-header">
                                        <h4 class="notice-title">${notice.title}</h4>
                                        <span class="notice-date">${new Date(notice.date).toLocaleDateString()}</span>
                                    </div>
                                    <div class="notice-content">
                                        ${notice.content}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                document.getElementById('dashboardPage').innerHTML = html;
                
                // Add event listeners for dashboard buttons
                document.getElementById('addStudentBtn')?.addEventListener('click', () => {
                    this.showStudentForm();
                });
                
                document.getElementById('markAttendanceBtn')?.addEventListener('click', () => {
                    this.loadPage('attendance');
                });
                
                document.getElementById('viewAllStudents')?.addEventListener('click', () => {
                    this.loadPage('students');
                });
                
                document.getElementById('addNoticeBtn')?.addEventListener('click', () => {
                    this.showNoticeForm();
                });
                
                document.getElementById('studentSearch')?.addEventListener('input', (e) => {
                    this.filterTable(e.target.value, 'recentStudentsTable');
                });
            }
            
            loadStudents() {
                const students = storage.getStudents();
                
                const html = `
                    <div class="page-header">
                        <h1 class="page-title">Student Management</h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" id="addStudentBtn">
                                <i class="fas fa-user-plus"></i> Add Student
                            </button>
                            <button class="btn btn-secondary" onclick="ui.exportTableToCSV('students')">
                                <i class="fas fa-download"></i> Export CSV
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">All Students (${students.length})</h3>
                            <div class="table-controls">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="studentSearch" placeholder="Search students...">
                                </div>
                                <select id="classFilter" class="form-control" style="width: 150px;">
                                    <option value="">All Classes</option>
                                    ${[...new Set(students.map(s => s.class))].map(cls => `
                                        <option value="${cls}">Class ${cls}</option>
                                    `).join('')}
                                </select>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table id="studentsTable">
                                <thead>
                                    <tr>
                                        <th>Admission No</th>
                                        <th>Name</th>
                                        <th>Class & Section</th>
                                        <th>Roll No</th>
                                        <th>Gender</th>
                                        <th>DOB</th>
                                        <th>Parent Name</th>
                                        <th>Phone</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${students.map(student => `
                                        <tr>
                                            <td>${student.admissionNo}</td>
                                            <td>
                                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                    <div class="attendance-avatar" style="width: 30px; height: 30px; font-size: 0.8rem;">
                                                        ${student.name.split(' ').map(n => n[0]).join('').toUpperCase()}
                                                    </div>
                                                    ${student.name}
                                                </div>
                                            </td>
                                            <td>${student.class} - ${student.section}</td>
                                            <td>${student.rollNo}</td>
                                            <td>${student.gender}</td>
                                            <td>${student.dob ? new Date(student.dob).toLocaleDateString() : ''}</td>
                                            <td>${student.parentName}</td>
                                            <td>${student.phone}</td>
                                            <td>
                                                <div style="display: flex; gap: 0.3rem;">
                                                    <button class="btn btn-sm btn-secondary" onclick="ui.showStudentProfile('${student.id}')" title="View Profile">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-primary" onclick="ui.showStudentForm('${student.id}')" title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" onclick="ui.deleteStudent('${student.id}')" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        ${students.length > 10 ? `
                            <div class="pagination">
                                <button class="pagination-btn" id="prevPage">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <div class="pagination-pages" id="pageNumbers">
                                    <!-- Pages will be generated by JS -->
                                </div>
                                <button class="pagination-btn" id="nextPage">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                document.getElementById('studentsPage').innerHTML = html;
                
                // Add event listeners
                document.getElementById('addStudentBtn').addEventListener('click', () => {
                    this.showStudentForm();
                });
                
                document.getElementById('studentSearch').addEventListener('input', (e) => {
                    this.filterTable(e.target.value, 'studentsTable');
                });
                
                document.getElementById('classFilter').addEventListener('change', (e) => {
                    this.filterTable(e.target.value, 'studentsTable', 2);
                });
                
                // Initialize pagination if needed
                if (students.length > 10) {
                    this.initPagination('studentsTable', 10);
                }
            }
            
            showStudentForm(studentId = null) {
                let student = null;
                if (studentId) {
                    const students = storage.getStudents();
                    student = students.find(s => s.id === studentId);
                }
                
                const html = `
                    <div class="modal-overlay" id="studentFormModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3 class="modal-title">${student ? 'Edit Student' : 'Add New Student'}</h3>
                                <button class="modal-close" id="closeStudentForm">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="studentForm">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Admission No *</label>
                                            <input type="text" class="form-control" name="admissionNo" value="${student?.admissionNo || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Roll No *</label>
                                            <input type="number" class="form-control" name="rollNo" value="${student?.rollNo || ''}" required>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Full Name *</label>
                                        <input type="text" class="form-control" name="name" value="${student?.name || ''}" required>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Class *</label>
                                            <select class="form-control" name="class" required>
                                                <option value="">Select Class</option>
                                                ${[1,2,3,4,5,6,7,8,9,10,11,12].map(num => `
                                                    <option value="${num}" ${student?.class == num ? 'selected' : ''}>Class ${num}</option>
                                                `).join('')}
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Section *</label>
                                            <select class="form-control" name="section" required>
                                                <option value="">Select Section</option>
                                                ${['A','B','C','D','E'].map(sec => `
                                                    <option value="${sec}" ${student?.section === sec ? 'selected' : ''}>Section ${sec}</option>
                                                `).join('')}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Gender *</label>
                                            <select class="form-control" name="gender" required>
                                                <option value="">Select Gender</option>
                                                <option value="Male" ${student?.gender === 'Male' ? 'selected' : ''}>Male</option>
                                                <option value="Female" ${student?.gender === 'Female' ? 'selected' : ''}>Female</option>
                                                <option value="Other" ${student?.gender === 'Other' ? 'selected' : ''}>Other</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Date of Birth</label>
                                            <input type="date" class="form-control" name="dob" value="${student?.dob || ''}">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Parent/Guardian Name *</label>
                                        <input type="text" class="form-control" name="parentName" value="${student?.parentName || ''}" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Phone Number *</label>
                                        <input type="tel" class="form-control" name="phone" value="${student?.phone || ''}" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Address</label>
                                        <textarea class="form-control" name="address" rows="3">${student?.address || ''}</textarea>
                                    </div>
                                    
                                    ${student ? `<input type="hidden" name="id" value="${student.id}">` : ''}
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="cancelStudentForm">Cancel</button>
                                <button class="btn btn-primary" id="saveStudent">${student ? 'Update' : 'Save'} Student</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Add event listeners
                document.getElementById('closeStudentForm').addEventListener('click', () => {
                    document.getElementById('studentFormModal').remove();
                });
                
                document.getElementById('cancelStudentForm').addEventListener('click', () => {
                    document.getElementById('studentFormModal').remove();
                });
                
                document.getElementById('saveStudent').addEventListener('click', () => {
                    this.saveStudent();
                });
            }
            
            saveStudent() {
                const form = document.getElementById('studentForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const formData = new FormData(form);
                const student = Object.fromEntries(formData.entries());
                
                storage.saveStudent(student);
                document.getElementById('studentFormModal').remove();
                
                this.showToast({
                    type: 'success',
                    message: `Student ${student.id ? 'updated' : 'added'} successfully`
                });
                
                // Reload current page
                this.loadPageContent(this.currentPage);
            }
            
            showStudentProfile(studentId) {
                const students = storage.getStudents();
                const student = students.find(s => s.id === studentId);
                
                if (!student) return;
                
                const attendance = storage.getAttendance();
                const studentAttendance = attendance.filter(a => 
                    a.students?.some(s => s.id === studentId)
                );
                
                const fees = storage.getFees();
                const studentFees = fees.filter(f => f.studentId === studentId);
                
                const results = storage.getResults();
                const studentResults = results.filter(r => r.studentId === studentId);
                
                const presentCount = studentAttendance.filter(a => 
                    a.students?.find(s => s.id === studentId)?.status === 'present'
                ).length;
                
                const totalCount = studentAttendance.length;
                const attendancePercentage = totalCount > 0 ? Math.round((presentCount / totalCount) * 100) : 0;
                
                const totalFees = studentFees.reduce((sum, fee) => sum + (parseFloat(fee.amount) || 0), 0);
                const paidFees = studentFees.filter(f => f.status === 'paid').reduce((sum, fee) => sum + (parseFloat(fee.amount) || 0), 0);
                
                const html = `
                    <div class="modal-overlay" id="studentProfileModal">
                        <div class="modal" style="max-width: 900px;">
                            <div class="modal-header">
                                <h3 class="modal-title">Student Profile</h3>
                                <button class="modal-close" id="closeStudentProfile">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="profile-header">
                                    <div class="profile-avatar">
                                        ${student.name.split(' ').map(n => n[0]).join('').toUpperCase()}
                                    </div>
                                    <div class="profile-info">
                                        <h2>${student.name}</h2>
                                        <p><strong>Admission No:</strong> ${student.admissionNo}</p>
                                        <p><strong>Class:</strong> ${student.class} - ${student.section} | <strong>Roll No:</strong> ${student.rollNo}</p>
                                        <p><strong>Parent:</strong> ${student.parentName} | <strong>Phone:</strong> ${student.phone}</p>
                                    </div>
                                </div>
                                
                                <div class="profile-tabs">
                                    <button class="tab-btn active" data-tab="personal">Personal Info</button>
                                    <button class="tab-btn" data-tab="attendance">Attendance</button>
                                    <button class="tab-btn" data-tab="fees">Fees</button>
                                    <button class="tab-btn" data-tab="results">Results</button>
                                </div>
                                
                                <div class="tab-content active" id="personalTab">
                                    <div class="card" style="margin-bottom: 1rem;">
                                        <div class="card-header">
                                            <h3 class="card-title">Personal Information</h3>
                                        </div>
                                        <div style="padding: 1.5rem;">
                                            <div class="form-row">
                                                <div class="form-group">
                                                    <label class="form-label">Gender</label>
                                                    <p>${student.gender}</p>
                                                </div>
                                                <div class="form-group">
                                                    <label class="form-label">Date of Birth</label>
                                                    <p>${student.dob ? new Date(student.dob).toLocaleDateString() : 'Not specified'}</p>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Address</label>
                                                <p>${student.address || 'Not specified'}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="attendanceTab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title">Attendance Summary</h3>
                                            <div class="card-icon attendance">
                                                <i class="fas fa-clipboard-check"></i>
                                            </div>
                                        </div>
                                        <div style="padding: 1.5rem;">
                                            <div style="display: flex; justify-content: space-around; text-align: center; margin-bottom: 2rem;">
                                                <div>
                                                    <h4>${presentCount}</h4>
                                                    <p>Days Present</p>
                                                </div>
                                                <div>
                                                    <h4>${totalCount - presentCount}</h4>
                                                    <p>Days Absent</p>
                                                </div>
                                                <div>
                                                    <h4>${attendancePercentage}%</h4>
                                                    <p>Attendance Rate</p>
                                                </div>
                                            </div>
                                            
                                            <h4>Recent Attendance</h4>
                                            <div class="table-responsive">
                                                <table>
                                                    <thead>
                                                        <tr>
                                                            <th>Date</th>
                                                            <th>Status</th>
                                                            <th>Class</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${studentAttendance.slice(0, 10).map(att => {
                                                            const studentRecord = att.students?.find(s => s.id === studentId);
                                                            return `
                                                                <tr>
                                                                    <td>${new Date(att.date).toLocaleDateString()}</td>
                                                                    <td>
                                                                        <span class="badge ${studentRecord?.status === 'present' ? 'badge-success' : 'badge-danger'}">
                                                                            ${studentRecord?.status || 'absent'}
                                                                        </span>
                                                                    </td>
                                                                    <td>${att.class} - ${att.section}</td>
                                                                </tr>
                                                            `;
                                                        }).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="feesTab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title">Fee Status</h3>
                                            <div class="card-icon fees">
                                                <i class="fas fa-money-check-alt"></i>
                                            </div>
                                        </div>
                                        <div style="padding: 1.5rem;">
                                            <div style="display: flex; justify-content: space-around; text-align: center; margin-bottom: 2rem;">
                                                <div>
                                                    <h4>${totalFees}</h4>
                                                    <p>Total Fees</p>
                                                </div>
                                                <div>
                                                    <h4>${paidFees}</h4>
                                                    <p>Paid</p>
                                                </div>
                                                <div>
                                                    <h4>${totalFees - paidFees}</h4>
                                                    <p>Due</p>
                                                </div>
                                            </div>
                                            
                                            <h4>Fee History</h4>
                                            ${studentFees.length > 0 ? `
                                                <div class="table-responsive">
                                                    <table>
                                                        <thead>
                                                            <tr>
                                                                <th>Date</th>
                                                                <th>Amount</th>
                                                                <th>Type</th>
                                                                <th>Status</th>
                                                                <th>Receipt No</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            ${studentFees.map(fee => `
                                                                <tr>
                                                                    <td>${new Date(fee.paymentDate).toLocaleDateString()}</td>
                                                                    <td>${fee.amount}</td>
                                                                    <td>${fee.type || 'Tuition'}</td>
                                                                    <td>
                                                                        <span class="badge ${fee.status === 'paid' ? 'badge-success' : 'badge-danger'}">
                                                                            ${fee.status}
                                                                        </span>
                                                                    </td>
                                                                    <td>${fee.receiptNo || 'N/A'}</td>
                                                                </tr>
                                                            `).join('')}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            ` : '<p>No fee records found.</p>'}
                                            
                                            <div style="margin-top: 1.5rem;">
                                                <button class="btn btn-primary" onclick="ui.showFeeForm('${studentId}')">
                                                    <i class="fas fa-plus"></i> Add Fee Record
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tab-content" id="resultsTab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title">Academic Results</h3>
                                            <div class="card-icon">
                                                <i class="fas fa-file-alt"></i>
                                            </div>
                                        </div>
                                        <div style="padding: 1.5rem;">
                                            ${studentResults.length > 0 ? `
                                                <div class="table-responsive">
                                                    <table>
                                                        <thead>
                                                            <tr>
                                                                <th>Exam</th>
                                                                <th>Subject</th>
                                                                <th>Marks</th>
                                                                <th>Grade</th>
                                                                <th>Status</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            ${studentResults.map(result => `
                                                                <tr>
                                                                    <td>${result.examName}</td>
                                                                    <td>${result.subject}</td>
                                                                    <td>${result.marksObtained}/${result.maxMarks}</td>
                                                                    <td>
                                                                        <span class="result-grade grade-${result.grade?.toLowerCase() || 'f'}">
                                                                            ${result.grade || 'F'}
                                                                        </span>
                                                                    </td>
                                                                    <td>
                                                                        <span class="badge ${result.status === 'pass' ? 'badge-success' : 'badge-danger'}">
                                                                            ${result.status || 'fail'}
                                                                        </span>
                                                                    </td>
                                                                </tr>
                                                            `).join('')}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            ` : '<p>No exam results found.</p>'}
                                            
                                            <div style="margin-top: 1.5rem;">
                                                <button class="btn btn-primary" onclick="ui.showResultForm('${studentId}')">
                                                    <i class="fas fa-plus"></i> Add Result
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="closeProfileBtn">Close</button>
                                <button class="btn btn-primary" onclick="ui.showStudentForm('${student.id}')">
                                    <i class="fas fa-edit"></i> Edit Student
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Add event listeners
                document.getElementById('closeStudentProfile').addEventListener('click', () => {
                    document.getElementById('studentProfileModal').remove();
                });
                
                document.getElementById('closeProfileBtn').addEventListener('click', () => {
                    document.getElementById('studentProfileModal').remove();
                });
                
                // Tab functionality
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tabId = btn.getAttribute('data-tab');
                        
                        // Update active tab button
                        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        
                        // Show active tab content
                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        document.getElementById(`${tabId}Tab`).classList.add('active');
                    });
                });
            }
            
            deleteStudent(studentId) {
                if (confirm('Are you sure you want to delete this student? This action cannot be undone.')) {
                    storage.deleteStudent(studentId);
                    this.showToast({ type: 'success', message: 'Student deleted successfully' });
                    this.loadPageContent(this.currentPage);
                }
            }
            
            loadTeachers() {
                const teachers = storage.getTeachers();
                
                const html = `
                    <div class="page-header">
                        <h1 class="page-title">Teacher Management</h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" id="addTeacherBtn">
                                <i class="fas fa-user-plus"></i> Add Teacher
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">All Teachers (${teachers.length})</h3>
                            <div class="table-controls">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="teacherSearch" placeholder="Search teachers...">
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table id="teachersTable">
                                <thead>
                                    <tr>
                                        <th>Employee ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>Subject</th>
                                        <th>Classes</th>
                                        <th>Qualification</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${teachers.map(teacher => `
                                        <tr>
                                            <td>${teacher.employeeId}</td>
                                            <td>
                                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                                    <div class="attendance-avatar" style="width: 30px; height: 30px; font-size: 0.8rem;">
                                                        ${teacher.name.split(' ').map(n => n[0]).join('').toUpperCase()}
                                                    </div>
                                                    ${teacher.name}
                                                </div>
                                            </td>
                                            <td>${teacher.email}</td>
                                            <td>${teacher.phone}</td>
                                            <td>${teacher.subject}</td>
                                            <td>${Array.isArray(teacher.classes) ? teacher.classes.join(', ') : teacher.classes}</td>
                                            <td>${teacher.qualification}</td>
                                            <td>
                                                <div style="display: flex; gap: 0.3rem;">
                                                    <button class="btn btn-sm btn-secondary" onclick="ui.showTeacherProfile('${teacher.id}')" title="View Profile">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-primary" onclick="ui.showTeacherForm('${teacher.id}')" title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" onclick="ui.deleteTeacher('${teacher.id}')" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                document.getElementById('teachersPage').innerHTML = html;
                
                // Add event listeners
                document.getElementById('addTeacherBtn').addEventListener('click', () => {
                    this.showTeacherForm();
                });
                
                document.getElementById('teacherSearch').addEventListener('input', (e) => {
                    this.filterTable(e.target.value, 'teachersTable');
                });
            }
            
            showTeacherForm(teacherId = null) {
                let teacher = null;
                if (teacherId) {
                    const teachers = storage.getTeachers();
                    teacher = teachers.find(t => t.id === teacherId);
                }
                
                const html = `
                    <div class="modal-overlay" id="teacherFormModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3 class="modal-title">${teacher ? 'Edit Teacher' : 'Add New Teacher'}</h3>
                                <button class="modal-close" id="closeTeacherForm">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="teacherForm">
                                    <div class="form-group">
                                        <label class="form-label">Employee ID *</label>
                                        <input type="text" class="form-control" name="employeeId" value="${teacher?.employeeId || ''}" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Full Name *</label>
                                        <input type="text" class="form-control" name="name" value="${teacher?.name || ''}" required>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Email *</label>
                                            <input type="email" class="form-control" name="email" value="${teacher?.email || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Phone *</label>
                                            <input type="tel" class="form-control" name="phone" value="${teacher?.phone || ''}" required>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Subject *</label>
                                        <input type="text" class="form-control" name="subject" value="${teacher?.subject || ''}" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Classes (comma separated) *</label>
                                        <input type="text" class="form-control" name="classes" value="${Array.isArray(teacher?.classes) ? teacher.classes.join(', ') : teacher?.classes || ''}" required placeholder="10, 11, 12">
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Qualification *</label>
                                            <input type="text" class="form-control" name="qualification" value="${teacher?.qualification || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Experience</label>
                                            <input type="text" class="form-control" name="experience" value="${teacher?.experience || ''}">
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Joined Date</label>
                                        <input type="date" class="form-control" name="joinedDate" value="${teacher?.joinedDate || ''}">
                                    </div>
                                    
                                    ${teacher ? `<input type="hidden" name="id" value="${teacher.id}">` : ''}
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="cancelTeacherForm">Cancel</button>
                                <button class="btn btn-primary" id="saveTeacher">${teacher ? 'Update' : 'Save'} Teacher</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Add event listeners
                document.getElementById('closeTeacherForm').addEventListener('click', () => {
                    document.getElementById('teacherFormModal').remove();
                });
                
                document.getElementById('cancelTeacherForm').addEventListener('click', () => {
                    document.getElementById('teacherFormModal').remove();
                });
                
                document.getElementById('saveTeacher').addEventListener('click', () => {
                    this.saveTeacher();
                });
            }
            
            saveTeacher() {
                const form = document.getElementById('teacherForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const formData = new FormData(form);
                const teacher = Object.fromEntries(formData.entries());
                
                // Convert classes string to array
                if (teacher.classes) {
                    teacher.classes = teacher.classes.split(',').map(c => c.trim());
                }
                
                storage.saveTeacher(teacher);
                document.getElementById('teacherFormModal').remove();
                
                this.showToast({
                    type: 'success',
                    message: `Teacher ${teacher.id ? 'updated' : 'added'} successfully`
                });
                
                // Reload current page
                this.loadPageContent(this.currentPage);
            }
            
            showTeacherProfile(teacherId) {
                const teachers = storage.getTeachers();
                const teacher = teachers.find(t => t.id === teacherId);
                
                if (!teacher) return;
                
                const html = `
                    <div class="modal-overlay" id="teacherProfileModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3 class="modal-title">Teacher Profile</h3>
                                <button class="modal-close" id="closeTeacherProfile">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="profile-header">
                                    <div class="profile-avatar">
                                        ${teacher.name.split(' ').map(n => n[0]).join('').toUpperCase()}
                                    </div>
                                    <div class="profile-info">
                                        <h2>${teacher.name}</h2>
                                        <p><strong>Employee ID:</strong> ${teacher.employeeId}</p>
                                        <p><strong>Subject:</strong> ${teacher.subject}</p>
                                        <p><strong>Email:</strong> ${teacher.email} | <strong>Phone:</strong> ${teacher.phone}</p>
                                    </div>
                                </div>
                                
                                <div class="card" style="margin-top: 1.5rem;">
                                    <div class="card-header">
                                        <h3 class="card-title">Teacher Information</h3>
                                    </div>
                                    <div style="padding: 1.5rem;">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">Qualification</label>
                                                <p>${teacher.qualification}</p>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Experience</label>
                                                <p>${teacher.experience || 'Not specified'}</p>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">Classes Assigned</label>
                                                <p>${Array.isArray(teacher.classes) ? teacher.classes.join(', ') : teacher.classes}</p>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Joined Date</label>
                                                <p>${teacher.joinedDate ? new Date(teacher.joinedDate).toLocaleDateString() : 'Not specified'}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="closeTeacherProfileBtn">Close</button>
                                <button class="btn btn-primary" onclick="ui.showTeacherForm('${teacher.id}')">
                                    <i class="fas fa-edit"></i> Edit Teacher
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Add event listeners
                document.getElementById('closeTeacherProfile').addEventListener('click', () => {
                    document.getElementById('teacherProfileModal').remove();
                });
                
                document.getElementById('closeTeacherProfileBtn').addEventListener('click', () => {
                    document.getElementById('teacherProfileModal').remove();
                });
            }
            
            deleteTeacher(teacherId) {
                if (confirm('Are you sure you want to delete this teacher? This action cannot be undone.')) {
                    storage.deleteTeacher(teacherId);
                    this.showToast({ type: 'success', message: 'Teacher deleted successfully' });
                    this.loadPageContent(this.currentPage);
                }
            }
            
            loadClasses() {
                const classes = storage.getClasses();
                const subjects = storage.getSubjects();
                
                const html = `
                    <div class="page-header">
                        <h1 class="page-title">Class & Subject Management</h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" id="addClassBtn">
                                <i class="fas fa-plus"></i> Add Class
                            </button>
                            <button class="btn btn-secondary" id="addSubjectBtn">
                                <i class="fas fa-book"></i> Add Subject
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container" style="margin-bottom: 2rem;">
                        <div class="table-header">
                            <h3 class="table-title">Classes (${classes.length})</h3>
                        </div>
                        <div class="table-responsive">
                            <table id="classesTable">
                                <thead>
                                    <tr>
                                        <th>Class Name</th>
                                        <th>Sections</th>
                                        <th>Subjects</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${classes.map(cls => `
                                        <tr>
                                            <td>${cls.name}</td>
                                            <td>${Array.isArray(cls.sections) ? cls.sections.join(', ') : cls.sections}</td>
                                            <td>${Array.isArray(cls.subjects) ? cls.subjects.join(', ') : cls.subjects}</td>
                                            <td>
                                                <div style="display: flex; gap: 0.3rem;">
                                                    <button class="btn btn-sm btn-primary" onclick="ui.showClassForm('${cls.id}')" title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" onclick="ui.deleteClass('${cls.id}')" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Subjects (${subjects.length})</h3>
                        </div>
                        <div class="table-responsive">
                            <table id="subjectsTable">
                                <thead>
                                    <tr>
                                        <th>Subject Name</th>
                                        <th>Code</th>
                                        <th>Teacher</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${subjects.map(subject => `
                                        <tr>
                                            <td>${subject.name}</td>
                                            <td>${subject.code}</td>
                                            <td>${subject.teacher}</td>
                                            <td>
                                                <div style="display: flex; gap: 0.3rem;">
                                                    <button class="btn btn-sm btn-primary" onclick="ui.showSubjectForm('${subject.id}')" title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" onclick="ui.deleteSubject('${subject.id}')" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                document.getElementById('classesPage').innerHTML = html;
                
                // Add event listeners
                document.getElementById('addClassBtn').addEventListener('click', () => {
                    this.showClassForm();
                });
                
                document.getElementById('addSubjectBtn').addEventListener('click', () => {
                    this.showSubjectForm();
                });
            }
            
            showClassForm(classId = null) {
                let cls = null;
                if (classId) {
                    const classes = storage.getClasses();
                    cls = classes.find(c => c.id === classId);
                }
                
                const html = `
                    <div class="modal-overlay" id="classFormModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3 class="modal-title">${cls ? 'Edit Class' : 'Add New Class'}</h3>
                                <button class="modal-close" id="closeClassForm">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="classForm">
                                    <div class="form-group">
                                        <label class="form-label">Class Name *</label>
                                        <input type="text" class="form-control" name="name" value="${cls?.name || ''}" required placeholder="e.g., Class 10">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Sections (comma separated) *</label>
                                        <input type="text" class="form-control" name="sections" value="${Array.isArray(cls?.sections) ? cls.sections.join(', ') : cls?.sections || ''}" required placeholder="e.g., A, B, C">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Subjects (comma separated) *</label>
                                        <input type="text" class="form-control" name="subjects" value="${Array.isArray(cls?.subjects) ? cls.subjects.join(', ') : cls?.subjects || ''}" required placeholder="e.g., Math, Science, English">
                                    </div>
                                    
                                    ${cls ? `<input type="hidden" name="id" value="${cls.id}">` : ''}
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="cancelClassForm">Cancel</button>
                                <button class="btn btn-primary" id="saveClass">${cls ? 'Update' : 'Save'} Class</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Add event listeners
                document.getElementById('closeClassForm').addEventListener('click', () => {
                    document.getElementById('classFormModal').remove();
                });
                
                document.getElementById('cancelClassForm').addEventListener('click', () => {
                    document.getElementById('classFormModal').remove();
                });
                
                document.getElementById('saveClass').addEventListener('click', () => {
                    this.saveClass();
                });
            }
            
            saveClass() {
                const form = document.getElementById('classForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const formData = new FormData(form);
                const cls = Object.fromEntries(formData.entries());
                
                // Convert sections and subjects to arrays
                if (cls.sections) {
                    cls.sections = cls.sections.split(',').map(s => s.trim());
                }
                if (cls.subjects) {
                    cls.subjects = cls.subjects.split(',').map(s => s.trim());
                }
                
                storage.saveClass(cls);
                document.getElementById('classFormModal').remove();
                
                this.showToast({
                    type: 'success',
                    message: `Class ${cls.id ? 'updated' : 'added'} successfully`
                });
                
                // Reload current page
                this.loadPageContent(this.currentPage);
            }
            
            deleteClass(classId) {
                if (confirm('Are you sure you want to delete this class? This action cannot be undone.')) {
                    storage.deleteClass(classId);
                    this.showToast({ type: 'success', message: 'Class deleted successfully' });
                    this.loadPageContent(this.currentPage);
                }
            }
            
            showSubjectForm(subjectId = null) {
                let subject = null;
                if (subjectId) {
                    const subjects = storage.getSubjects();
                    subject = subjects.find(s => s.id === subjectId);
                }
                
                const html = `
                    <div class="modal-overlay" id="subjectFormModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3 class="modal-title">${subject ? 'Edit Subject' : 'Add New Subject'}</h3>
                                <button class="modal-close" id="closeSubjectForm">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="subjectForm">
                                    <div class="form-group">
                                        <label class="form-label">Subject Name *</label>
                                        <input type="text" class="form-control" name="name" value="${subject?.name || ''}" required>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Subject Code *</label>
                                            <input type="text" class="form-control" name="code" value="${subject?.code || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Teacher *</label>
                                            <input type="text" class="form-control" name="teacher" value="${subject?.teacher || ''}" required>
                                        </div>
                                    </div>
                                    
                                    ${subject ? `<input type="hidden" name="id" value="${subject.id}">` : ''}
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="cancelSubjectForm">Cancel</button>
                                <button class="btn btn-primary" id="saveSubject">${subject ? 'Update' : 'Save'} Subject</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Add event listeners
                document.getElementById('closeSubjectForm').addEventListener('click', () => {
                    document.getElementById('subjectFormModal').remove();
                });
                
                document.getElementById('cancelSubjectForm').addEventListener('click', () => {
                    document.getElementById('subjectFormModal').remove();
                });
                
                document.getElementById('saveSubject').addEventListener('click', () => {
                    this.saveSubject();
                });
            }
            
            saveSubject() {
                const form = document.getElementById('subjectForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const formData = new FormData(form);
                const subject = Object.fromEntries(formData.entries());
                
                storage.saveSubject(subject);
                document.getElementById('subjectFormModal').remove();
                
                this.showToast({
                    type: 'success',
                    message: `Subject ${subject.id ? 'updated' : 'added'} successfully`
                });
                
                // Reload current page
                this.loadPageContent(this.currentPage);
            }
            
            deleteSubject(subjectId) {
                if (confirm('Are you sure you want to delete this subject? This action cannot be undone.')) {
                    storage.deleteSubject(subjectId);
                    this.showToast({ type: 'success', message: 'Subject deleted successfully' });
                    this.loadPageContent(this.currentPage);
                }
            }
            
            loadAttendance() {
                const students = storage.getStudents();
                const classes = [...new Set(students.map(s => s.class))];
                
                const html = `
                    <div class="page-header">
                        <h1 class="page-title">Attendance Management</h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" id="markAttendanceBtn" ${students.length === 0 ? 'disabled' : ''}>
                                <i class="fas fa-clipboard-check"></i> Mark Attendance
                            </button>
                        </div>
                    </div>
                    
                    <div class="card" style="margin-bottom: 2rem;">
                        <div style="padding: 1.5rem;">
                            <h3>Quick Attendance</h3>
                            <form id="quickAttendanceForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Date</label>
                                        <input type="date" class="form-control" id="attendanceDate" value="${new Date().toISOString().split('T')[0]}">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Class</label>
                                        <select class="form-control" id="attendanceClass" required>
                                            <option value="">Select Class</option>
                                            ${classes.map(cls => `
                                                <option value="${cls}">Class ${cls}</option>
                                            `).join('')}
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Section</label>
                                        <select class="form-control" id="attendanceSection" required>
                                            <option value="">Select Section</option>
                                            ${['A','B','C','D','E'].map(sec => `
                                                <option value="${sec}">Section ${sec}</option>
                                            `).join('')}
                                        </select>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="attendanceContainer">
                        <div class="card">
                            <div style="padding: 2rem; text-align: center;">
                                <h3>Select Class and Section to Mark Attendance</h3>
                                <p>Choose a class and section from the dropdown above to start marking attendance.</p>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('attendancePage').innerHTML = html;
                
                // Add event listeners
                document.getElementById('markAttendanceBtn').addEventListener('click', () => {
                    this.showAttendanceMarking();
                });
                
                document.getElementById('attendanceClass').addEventListener('change', () => {
                    this.updateAttendanceView();
                });
                
                document.getElementById('attendanceSection').addEventListener('change', () => {
                    this.updateAttendanceView();
                });
                
                document.getElementById('attendanceDate').addEventListener('change', () => {
                    this.updateAttendanceView();
                });
            }
            
            updateAttendanceView() {
                const classVal = document.getElementById('attendanceClass').value;
                const sectionVal = document.getElementById('attendanceSection').value;
                const dateVal = document.getElementById('attendanceDate').value;
                
                if (!classVal || !sectionVal) {
                    return;
                }
                
                const students = storage.getStudents();
                const classStudents = students.filter(s => s.class == classVal && s.section === sectionVal);
                const attendance = storage.getAttendance();
                const todayAttendance = attendance.find(a => a.date === dateVal && a.class == classVal && a.section === sectionVal);
                
                let attendanceGrid = '';
                
                if (classStudents.length > 0) {
                    attendanceGrid = `
                        <div class="attendance-grid" id="attendanceGrid">
                            ${classStudents.map(student => {
                                const studentAttendance = todayAttendance?.students?.find(s => s.id === student.id);
                                const status = studentAttendance?.status || 'absent';
                                return `
                                    <div class="attendance-card ${status} ${studentAttendance ? 'selected' : ''}" data-student-id="${student.id}" onclick="ui.toggleAttendance('${student.id}')">
                                        <div class="attendance-avatar">
                                            ${student.name.split(' ').map(n => n[0]).join('').toUpperCase()}
                                        </div>
                                        <div class="attendance-name">${student.name}</div>
                                        <div class="attendance-status badge ${status === 'present' ? 'badge-success' : 'badge-danger'}">
                                            ${status === 'present' ? 'Present' : 'Absent'}
                                        </div>
                                        <div class="attendance-roll">Roll: ${student.rollNo}</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div style="margin-top: 2rem; text-align: center;">
                            <button class="btn btn-success" id="saveAttendanceBtn" style="padding: 1rem 2rem; font-size: 1.1rem;">
                                <i class="fas fa-save"></i> Save Attendance
                            </button>
                            <div style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-secondary);">
                                Click on student cards to toggle between Present/Absent
                            </div>
                        </div>
                    `;
                } else {
                    attendanceGrid = `
                        <div class="card">
                            <div style="padding: 2rem; text-align: center;">
                                <h3>No Students Found</h3>
                                <p>No students found for Class ${classVal} - Section ${sectionVal}</p>
                            </div>
                        </div>
                    `;
                }
                
                document.getElementById('attendanceContainer').innerHTML = attendanceGrid;
                
                // Add event listener for save button if it exists
                const saveBtn = document.getElementById('saveAttendanceBtn');
                if (saveBtn) {
                    saveBtn.addEventListener('click', () => {
                        this.saveAttendance();
                    });
                }
            }
            
            toggleAttendance(studentId) {
                const card = document.querySelector(`.attendance-card[data-student-id="${studentId}"]`);
                if (!card) return;
                
                const isPresent = card.classList.contains('present');
                const newStatus = isPresent ? 'absent' : 'present';
                
                // Update UI
                card.classList.remove('present', 'absent');
                card.classList.add(newStatus, 'selected');
                
                const statusElement = card.querySelector('.attendance-status');
                statusElement.textContent = newStatus === 'present' ? 'Present' : 'Absent';
                statusElement.className = `attendance-status badge ${newStatus === 'present' ? 'badge-success' : 'badge-danger'}`;
                
                // Update data
                const existingRecord = this.currentAttendance.students.find(s => s.id === studentId);
                if (existingRecord) {
                    existingRecord.status = newStatus;
                } else {
                    const students = storage.getStudents();
                    const student = students.find(s => s.id === studentId);
                    if (student) {
                        this.currentAttendance.students.push({
                            id: studentId,
                            name: student.name,
                            rollNo: student.rollNo,
                            status: newStatus
                        });
                    }
                }
            }
            
            saveAttendance() {
                const classVal = document.getElementById('attendanceClass').value;
                const sectionVal = document.getElementById('attendanceSection').value;
                const dateVal = document.getElementById('attendanceDate').value;
                
                if (!classVal || !sectionVal) {
                    this.showToast({ type: 'error', message: 'Please select class and section' });
                    return;
                }
                
                if (this.currentAttendance.students.length === 0) {
                    this.showToast({ type: 'error', message: 'No attendance data to save' });
                    return;
                }
                
                const attendance = {
                    date: dateVal,
                    class: classVal,
                    section: sectionVal,
                    students: this.currentAttendance.students
                };
                
                storage.saveAttendance(attendance);
                this.showToast({ type: 'success', message: 'Attendance saved successfully' });
                
                // Reset current attendance
                this.currentAttendance.students = [];
                
                // Update view to show saved attendance
                this.updateAttendanceView();
            }
            
            loadExams() {
                const exams = storage.getExams();
                
                const html = `
                    <div class="page-header">
                        <h1 class="page-title">Exams & Results</h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" id="addExamBtn">
                                <i class="fas fa-plus"></i> Create Exam
                            </button>
                            <button class="btn btn-secondary" id="addResultBtn">
                                <i class="fas fa-file-alt"></i> Add Results
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container" style="margin-bottom: 2rem;">
                        <div class="table-header">
                            <h3 class="table-title">Exams (${exams.length})</h3>
                            <div class="table-controls">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="examSearch" placeholder="Search exams...">
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table id="examsTable">
                                <thead>
                                    <tr>
                                        <th>Exam Name</th>
                                        <th>Class</th>
                                        <th>Subject</th>
                                        <th>Date</th>
                                        <th>Max Marks</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${exams.map(exam => `
                                        <tr>
                                            <td>${exam.name}</td>
                                            <td>Class ${exam.class}</td>
                                            <td>${exam.subject}</td>
                                            <td>${new Date(exam.date).toLocaleDateString()}</td>
                                            <td>${exam.maxMarks}</td>
                                            <td>
                                                <div style="display: flex; gap: 0.3rem;">
                                                    <button class="btn btn-sm btn-secondary" onclick="ui.showExamResults('${exam.id}')" title="View Results">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-primary" onclick="ui.showExamForm('${exam.id}')" title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" onclick="ui.deleteExam('${exam.id}')" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div style="padding: 1.5rem;">
                            <h3>Recent Results</h3>
                            <div id="recentResults">
                                <!-- Results will be loaded here -->
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('examsPage').innerHTML = html;
                
                // Add event listeners
                document.getElementById('addExamBtn').addEventListener('click', () => {
                    this.showExamForm();
                });
                
                document.getElementById('addResultBtn').addEventListener('click', () => {
                    this.showResultForm();
                });
                
                document.getElementById('examSearch').addEventListener('input', (e) => {
                    this.filterTable(e.target.value, 'examsTable');
                });
                
                // Load recent results
                this.loadRecentResults();
            }
            
            showExamForm(examId = null) {
                let exam = null;
                if (examId) {
                    const exams = storage.getExams();
                    exam = exams.find(e => e.id === examId);
                }
                
                const classes = storage.getClasses();
                const subjects = storage.getSubjects();
                
                const html = `
                    <div class="modal-overlay" id="examFormModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3 class="modal-title">${exam ? 'Edit Exam' : 'Create New Exam'}</h3>
                                <button class="modal-close" id="closeExamForm">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="examForm">
                                    <div class="form-group">
                                        <label class="form-label">Exam Name *</label>
                                        <input type="text" class="form-control" name="name" value="${exam?.name || ''}" required placeholder="e.g., Unit Test 1, Midterm, Final">
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Class *</label>
                                            <select class="form-control" name="class" required>
                                                <option value="">Select Class</option>
                                                ${classes.map(cls => `
                                                    <option value="${cls.name.replace('Class ', '')}" ${exam?.class == cls.name.replace('Class ', '') ? 'selected' : ''}>${cls.name}</option>
                                                `).join('')}
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Subject *</label>
                                            <select class="form-control" name="subject" required>
                                                <option value="">Select Subject</option>
                                                ${subjects.map(subject => `
                                                    <option value="${subject.name}" ${exam?.subject === subject.name ? 'selected' : ''}>${subject.name}</option>
                                                `).join('')}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Date *</label>
                                            <input type="date" class="form-control" name="date" value="${exam?.date || ''}" required>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Max Marks *</label>
                                            <input type="number" class="form-control" name="maxMarks" value="${exam?.maxMarks || 100}" required>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Description</label>
                                        <textarea class="form-control" name="description" rows="3">${exam?.description || ''}</textarea>
                                    </div>
                                    
                                    ${exam ? `<input type="hidden" name="id" value="${exam.id}">` : ''}
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="cancelExamForm">Cancel</button>
                                <button class="btn btn-primary" id="saveExam">${exam ? 'Update' : 'Create'} Exam</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Add event listeners
                document.getElementById('closeExamForm').addEventListener('click', () => {
                    document.getElementById('examFormModal').remove();
                });
                
                document.getElementById('cancelExamForm').addEventListener('click', () => {
                    document.getElementById('examFormModal').remove();
                });
                
                document.getElementById('saveExam').addEventListener('click', () => {
                    this.saveExam();
                });
            }
            
            saveExam() {
                const form = document.getElementById('examForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const formData = new FormData(form);
                const exam = Object.fromEntries(formData.entries());
                
                storage.saveExam(exam);
                document.getElementById('examFormModal').remove();
                
                this.showToast({
                    type: 'success',
                    message: `Exam ${exam.id ? 'updated' : 'created'} successfully`
                });
                
                // Reload current page
                this.loadPageContent(this.currentPage);
            }
            
            deleteExam(examId) {
                if (confirm('Are you sure you want to delete this exam? This will also delete all associated results.')) {
                    storage.deleteExam(examId);
                    this.showToast({ type: 'success', message: 'Exam deleted successfully' });
                    this.loadPageContent(this.currentPage);
                }
            }
            
            showExamResults(examId) {
                const exams = storage.getExams();
                const exam = exams.find(e => e.id === examId);
                const results = storage.getResults();
                const examResults = results.filter(r => r.examId === examId);
                
                if (!exam) return;
                
                let resultsTable = '';
                
                if (examResults.length > 0) {
                    resultsTable = `
                        <div class="table-responsive">
                            <table class="exam-results-table">
                                <thead>
                                    <tr>
                                        <th>Student Name</th>
                                        <th>Roll No</th>
                                        <th>Marks Obtained</th>
                                        <th>Percentage</th>
                                        <th>Grade</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${examResults.map(result => {
                                        const percentage = ((result.marksObtained / exam.maxMarks) * 100).toFixed(2);
                                        const grade = this.calculateGrade(percentage);
                                        return `
                                            <tr>
                                                <td>${result.studentName}</td>
                                                <td>${result.rollNo}</td>
                                                <td>${result.marksObtained}/${exam.maxMarks}</td>
                                                <td>${percentage}%</td>
                                                <td>
                                                    <span class="result-grade grade-${grade.toLowerCase()}">
                                                        ${grade}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="badge ${percentage >= 33 ? 'badge-success' : 'badge-danger'}">
                                                        ${percentage >= 33 ? 'Pass' : 'Fail'}
                                                    </span>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                } else {
                    resultsTable = '<p>No results recorded for this exam yet.</p>';
                }
                
                const html = `
                    <div class="modal-overlay" id="examResultsModal">
                        <div class="modal" style="max-width: 800px;">
                            <div class="modal-header">
                                <h3 class="modal-title">Results: ${exam.name}</h3>
                                <button class="modal-close" id="closeExamResults">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="card" style="margin-bottom: 1.5rem;">
                                    <div style="padding: 1.5rem;">
                                        <h4>Exam Details</h4>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label class="form-label">Class</label>
                                                <p>Class ${exam.class}</p>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Subject</label>
                                                <p>${exam.subject}</p>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Date</label>
                                                <p>${new Date(exam.date).toLocaleDateString()}</p>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Description</label>
                                            <p>${exam.description || 'No description'}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <h4>Student Results</h4>
                                ${resultsTable}
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="closeExamResultsBtn">Close</button>
                                <button class="btn btn-primary" onclick="ui.showResultForm(null, '${examId}')">
                                    <i class="fas fa-plus"></i> Add Results
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Add event listeners
                document.getElementById('closeExamResults').addEventListener('click', () => {
                    document.getElementById('examResultsModal').remove();
                });
                
                document.getElementById('closeExamResultsBtn').addEventListener('click', () => {
                    document.getElementById('examResultsModal').remove();
                });
            }
            
            calculateGrade(percentage) {
                if (percentage >= 90) return 'A+';
                if (percentage >= 80) return 'A';
                if (percentage >= 70) return 'B+';
                if (percentage >= 60) return 'B';
                if (percentage >= 50) return 'C+';
                if (percentage >= 40) return 'C';
                if (percentage >= 33) return 'D';
                return 'F';
            }
            
            loadRecentResults() {
                const results = storage.getResults();
                const recentResults = results.slice(0, 10);
                
                const container = document.getElementById('recentResults');
                if (!container) return;
                
                if (recentResults.length > 0) {
                    let html = `
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Student</th>
                                        <th>Exam</th>
                                        <th>Subject</th>
                                        <th>Marks</th>
                                        <th>Grade</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${recentResults.map(result => {
                                        const exams = storage.getExams();
                                        const exam = exams.find(e => e.id === result.examId);
                                        if (!exam) return '';
                                        
                                        const percentage = ((result.marksObtained / exam.maxMarks) * 100).toFixed(2);
                                        const grade = this.calculateGrade(percentage);
                                        
                                        return `
                                            <tr>
                                                <td>${result.studentName}</td>
                                                <td>${exam.name}</td>
                                                <td>${exam.subject}</td>
                                                <td>${result.marksObtained}/${exam.maxMarks}</td>
                                                <td>
                                                    <span class="result-grade grade-${grade.toLowerCase()}">
                                                        ${grade}
                                                    </span>
                                                </td>
                                                <td>
                                                    <span class="badge ${percentage >= 33 ? 'badge-success' : 'badge-danger'}">
                                                        ${percentage >= 33 ? 'Pass' : 'Fail'}
                                                    </span>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<p>No results recorded yet.</p>';
                }
            }
            
            showResultForm(studentId = null, examId = null) {
                const students = storage.getStudents();
                const exams = storage.getExams();
                
                const html = `
                    <div class="modal-overlay" id="resultFormModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3 class="modal-title">Add Exam Result</h3>
                                <button class="modal-close" id="closeResultForm">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="resultForm">
                                    <div class="form-group">
                                        <label class="form-label">Student *</label>
                                        <select class="form-control" name="studentId" required>
                                            <option value="">Select Student</option>
                                            ${students.map(student => `
                                                <option value="${student.id}" ${studentId === student.id ? 'selected' : ''}>
                                                    ${student.name} (Class ${student.class} - ${student.section}, Roll: ${student.rollNo})
                                                </option>
                                            `).join('')}
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Exam *</label>
                                        <select class="form-control" name="examId" required>
                                            <option value="">Select Exam</option>
                                            ${exams.map(exam => `
                                                <option value="${exam.id}" ${examId === exam.id ? 'selected' : ''}>
                                                    ${exam.name} (Class ${exam.class} - ${exam.subject})
                                                </option>
                                            `).join('')}
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Marks Obtained *</label>
                                        <input type="number" class="form-control" name="marksObtained" required step="0.01">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Remarks</label>
                                        <textarea class="form-control" name="remarks" rows="2"></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="cancelResultForm">Cancel</button>
                                <button class="btn btn-primary" id="saveResult">Save Result</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Add event listeners
                document.getElementById('closeResultForm').addEventListener('click', () => {
                    document.getElementById('resultFormModal').remove();
                });
                
                document.getElementById('cancelResultForm').addEventListener('click', () => {
                    document.getElementById('resultFormModal').remove();
                });
                
                document.getElementById('saveResult').addEventListener('click', () => {
                    this.saveResult();
                });
            }
            
            saveResult() {
                const form = document.getElementById('resultForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const formData = new FormData(form);
                const result = Object.fromEntries(formData.entries());
                
                // Get student and exam details
                const students = storage.getStudents();
                const exams = storage.getExams();
                
                const student = students.find(s => s.id === result.studentId);
                const exam = exams.find(e => e.id === result.examId);
                
                if (!student || !exam) {
                    this.showToast({ type: 'error', message: 'Invalid student or exam selected' });
                    return;
                }
                
                // Add additional details
                result.studentName = student.name;
                result.rollNo = student.rollNo;
                result.examName = exam.name;
                result.subject = exam.subject;
                result.maxMarks = exam.maxMarks;
                
                // Calculate percentage and grade
                const percentage = ((parseFloat(result.marksObtained) / parseFloat(exam.maxMarks)) * 100).toFixed(2);
                const grade = this.calculateGrade(percentage);
                result.percentage = percentage;
                result.grade = grade;
                result.status = percentage >= 33 ? 'pass' : 'fail';
                
                storage.saveResult(result);
                document.getElementById('resultFormModal').remove();
                
                this.showToast({
                    type: 'success',
                    message: 'Result saved successfully'
                });
                
                // Reload recent results
                this.loadRecentResults();
            }
            
            loadFees() {
                const feeStructure = storage.getFeeStructure();
                const fees = storage.getFees();
                
                const html = `
                    <div class="page-header">
                        <h1 class="page-title">Fee Management</h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" id="addFeeStructureBtn">
                                <i class="fas fa-plus"></i> Add Fee Structure
                            </button>
                            <button class="btn btn-secondary" id="recordPaymentBtn">
                                <i class="fas fa-money-check-alt"></i> Record Payment
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container" style="margin-bottom: 2rem;">
                        <div class="table-header">
                            <h3 class="table-title">Fee Structure</h3>
                        </div>
                        <div class="table-responsive">
                            <table class="fee-structure-table">
                                <thead>
                                    <tr>
                                        <th>Class</th>
                                        <th>Term</th>
                                        <th>Amount ()</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${feeStructure.map(fee => `
                                        <tr>
                                            <td>Class ${fee.class}</td>
                                            <td>${fee.term}</td>
                                            <td class="fee-amount">${fee.amount}</td>
                                            <td>${fee.description}</td>
                                            <td>
                                                <div style="display: flex; gap: 0.3rem;">
                                                    <button class="btn btn-sm btn-primary" onclick="ui.showFeeStructureForm('${fee.id}')" title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" onclick="ui.deleteFeeStructure('${fee.id}')" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Recent Payments (${fees.length})</h3>
                            <div class="table-controls">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="feeSearch" placeholder="Search payments...">
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table id="feesTable">
                                <thead>
                                    <tr>
                                        <th>Student</th>
                                        <th>Class</th>
                                        <th>Amount ()</th>
                                        <th>Type</th>
                                        <th>Payment Date</th>
                                        <th>Status</th>
                                        <th>Receipt No</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${fees.slice(0, 20).map(fee => {
                                        const students = storage.getStudents();
                                        const student = students.find(s => s.id === fee.studentId);
                                        return `
                                            <tr>
                                                <td>${student ? student.name : 'Unknown'}</td>
                                                <td>${student ? student.class : 'N/A'}</td>
                                                <td class="fee-amount">${fee.amount}</td>
                                                <td>${fee.type || 'Tuition'}</td>
                                                <td>${new Date(fee.paymentDate).toLocaleDateString()}</td>
                                                <td>
                                                    <span class="badge ${fee.status === 'paid' ? 'badge-success' : 'badge-danger'}">
                                                        ${fee.status}
                                                    </span>
                                                </td>
                                                <td>${fee.receiptNo || 'N/A'}</td>
                                                <td>
                                                    <div style="display: flex; gap: 0.3rem;">
                                                        <button class="btn btn-sm btn-primary" onclick="ui.showFeeForm(null, '${fee.id}')" title="Edit">
                                                            <i class="fas fa-edit"></i>
                                                        </button>
                                                        <button class="btn btn-sm btn-danger" onclick="ui.deleteFee('${fee.id}')" title="Delete">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                document.getElementById('feesPage').innerHTML = html;
                
                // Add event listeners
                document.getElementById('addFeeStructureBtn').addEventListener('click', () => {
                    this.showFeeStructureForm();
                });
                
                document.getElementById('recordPaymentBtn').addEventListener('click', () => {
                    this.showFeeForm();
                });
                
                document.getElementById('feeSearch').addEventListener('input', (e) => {
                    this.filterTable(e.target.value, 'feesTable');
                });
            }
            
            showFeeStructureForm(feeStructureId = null) {
                let feeStructure = null;
                if (feeStructureId) {
                    const structures = storage.getFeeStructure();
                    feeStructure = structures.find(f => f.id === feeStructureId);
                }
                
                const html = `
                    <div class="modal-overlay" id="feeStructureFormModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3 class="modal-title">${feeStructure ? 'Edit Fee Structure' : 'Add Fee Structure'}</h3>
                                <button class="modal-close" id="closeFeeStructureForm">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="feeStructureForm">
                                    <div class="form-group">
                                        <label class="form-label">Class *</label>
                                        <select class="form-control" name="class" required>
                                            <option value="">Select Class</option>
                                            ${[1,2,3,4,5,6,7,8,9,10,11,12].map(num => `
                                                <option value="${num}" ${feeStructure?.class == num ? 'selected' : ''}>Class ${num}</option>
                                            `).join('')}
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Term *</label>
                                        <select class="form-control" name="term" required>
                                            <option value="">Select Term</option>
                                            <option value="Annual" ${feeStructure?.term === 'Annual' ? 'selected' : ''}>Annual</option>
                                            <option value="Half Yearly" ${feeStructure?.term === 'Half Yearly' ? 'selected' : ''}>Half Yearly</option>
                                            <option value="Quarterly" ${feeStructure?.term === 'Quarterly' ? 'selected' : ''}>Quarterly</option>
                                            <option value="Monthly" ${feeStructure?.term === 'Monthly' ? 'selected' : ''}>Monthly</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Amount () *</label>
                                        <input type="number" class="form-control" name="amount" value="${feeStructure?.amount || ''}" required step="0.01">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Description</label>
                                        <textarea class="form-control" name="description" rows="3">${feeStructure?.description || ''}</textarea>
                                    </div>
                                    
                                    ${feeStructure ? `<input type="hidden" name="id" value="${feeStructure.id}">` : ''}
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="cancelFeeStructureForm">Cancel</button>
                                <button class="btn btn-primary" id="saveFeeStructure">${feeStructure ? 'Update' : 'Save'} Fee Structure</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Add event listeners
                document.getElementById('closeFeeStructureForm').addEventListener('click', () => {
                    document.getElementById('feeStructureFormModal').remove();
                });
                
                document.getElementById('cancelFeeStructureForm').addEventListener('click', () => {
                    document.getElementById('feeStructureFormModal').remove();
                });
                
                document.getElementById('saveFeeStructure').addEventListener('click', () => {
                    this.saveFeeStructure();
                });
            }
            
            saveFeeStructure() {
                const form = document.getElementById('feeStructureForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const formData = new FormData(form);
                const feeStructure = Object.fromEntries(formData.entries());
                
                storage.saveFeeStructure(feeStructure);
                document.getElementById('feeStructureFormModal').remove();
                
                this.showToast({
                    type: 'success',
                    message: `Fee structure ${feeStructure.id ? 'updated' : 'added'} successfully`
                });
                
                // Reload current page
                this.loadPageContent(this.currentPage);
            }
            
            deleteFeeStructure(feeStructureId) {
                if (confirm('Are you sure you want to delete this fee structure?')) {
                    storage.deleteFeeStructure(feeStructureId);
                    this.showToast({ type: 'success', message: 'Fee structure deleted successfully' });
                    this.loadPageContent(this.currentPage);
                }
            }
            
            showFeeForm(studentId = null, feeId = null) {
                let fee = null;
                if (feeId) {
                    const fees = storage.getFees();
                    fee = fees.find(f => f.id === feeId);
                }
                
                const students = storage.getStudents();
                
                const html = `
                    <div class="modal-overlay" id="feeFormModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3 class="modal-title">${fee ? 'Edit Fee Record' : 'Record Payment'}</h3>
                                <button class="modal-close" id="closeFeeForm">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="feeForm">
                                    <div class="form-group">
                                        <label class="form-label">Student *</label>
                                        <select class="form-control" name="studentId" required ${fee ? 'disabled' : ''}>
                                            <option value="">Select Student</option>
                                            ${students.map(student => `
                                                <option value="${student.id}" ${(studentId === student.id || fee?.studentId === student.id) ? 'selected' : ''}>
                                                    ${student.name} (Class ${student.class} - ${student.section})
                                                </option>
                                            `).join('')}
                                        </select>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Amount () *</label>
                                            <input type="number" class="form-control" name="amount" value="${fee?.amount || ''}" required step="0.01">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Payment Date *</label>
                                            <input type="date" class="form-control" name="paymentDate" value="${fee?.paymentDate || new Date().toISOString().split('T')[0]}" required>
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Type</label>
                                            <select class="form-control" name="type">
                                                <option value="Tuition" ${fee?.type === 'Tuition' ? 'selected' : ''}>Tuition</option>
                                                <option value="Exam" ${fee?.type === 'Exam' ? 'selected' : ''}>Exam</option>
                                                <option value="Library" ${fee?.type === 'Library' ? 'selected' : ''}>Library</option>
                                                <option value="Transport" ${fee?.type === 'Transport' ? 'selected' : ''}>Transport</option>
                                                <option value="Other" ${fee?.type === 'Other' ? 'selected' : ''}>Other</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Status *</label>
                                            <select class="form-control" name="status" required>
                                                <option value="paid" ${fee?.status === 'paid' ? 'selected' : ''}>Paid</option>
                                                <option value="pending" ${fee?.status === 'pending' ? 'selected' : ''}>Pending</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Receipt No</label>
                                            <input type="text" class="form-control" name="receiptNo" value="${fee?.receiptNo || ''}">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Payment Mode</label>
                                            <select class="form-control" name="paymentMode">
                                                <option value="Cash" ${fee?.paymentMode === 'Cash' ? 'selected' : ''}>Cash</option>
                                                <option value="Cheque" ${fee?.paymentMode === 'Cheque' ? 'selected' : ''}>Cheque</option>
                                                <option value="Online" ${fee?.paymentMode === 'Online' ? 'selected' : ''}>Online</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Remarks</label>
                                        <textarea class="form-control" name="remarks" rows="2">${fee?.remarks || ''}</textarea>
                                    </div>
                                    
                                    ${fee ? `<input type="hidden" name="id" value="${fee.id}">` : ''}
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="cancelFeeForm">Cancel</button>
                                <button class="btn btn-primary" id="saveFee">${fee ? 'Update' : 'Save'} Payment</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Add event listeners
                document.getElementById('closeFeeForm').addEventListener('click', () => {
                    document.getElementById('feeFormModal').remove();
                });
                
                document.getElementById('cancelFeeForm').addEventListener('click', () => {
                    document.getElementById('feeFormModal').remove();
                });
                
                document.getElementById('saveFee').addEventListener('click', () => {
                    this.saveFee();
                });
            }
            
            saveFee() {
                const form = document.getElementById('feeForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const formData = new FormData(form);
                const fee = Object.fromEntries(formData.entries());
                
                // Generate receipt number if not provided
                if (!fee.receiptNo) {
                    fee.receiptNo = 'REC' + Date.now().toString().slice(-8);
                }
                
                storage.saveFee(fee);
                document.getElementById('feeFormModal').remove();
                
                this.showToast({
                    type: 'success',
                    message: `Payment ${fee.id ? 'updated' : 'recorded'} successfully`
                });
                
                // Reload current page
                this.loadPageContent(this.currentPage);
            }
            
            deleteFee(feeId) {
                if (confirm('Are you sure you want to delete this fee record?')) {
                    storage.deleteFee(feeId);
                    this.showToast({ type: 'success', message: 'Fee record deleted successfully' });
                    this.loadPageContent(this.currentPage);
                }
            }
            
            loadTimetable() {
                const timetable = storage.getTimetable();
                
                const html = `
                    <div class="page-header">
                        <h1 class="page-title">Timetable Management</h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" id="addTimetableBtn">
                                <i class="fas fa-plus"></i> Create Timetable
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title">Timetables (${timetable.length})</h3>
                        </div>
                        <div class="table-responsive">
                            <table id="timetableTable">
                                <thead>
                                    <tr>
                                        <th>Class</th>
                                        <th>Section</th>
                                        <th>Days</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${timetable.map(tt => `
                                        <tr>
                                            <td>Class ${tt.class}</td>
                                            <td>${tt.section}</td>
                                            <td>${tt.periods ? tt.periods.length : 0} days</td>
                                            <td>
                                                <div style="display: flex; gap: 0.3rem;">
                                                    <button class="btn btn-sm btn-secondary" onclick="ui.showTimetable('${tt.id}')" title="View">
                                                        <i class="fas fa-eye"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-primary" onclick="ui.showTimetableForm('${tt.id}')" title="Edit">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" onclick="ui.deleteTimetable('${tt.id}')" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                document.getElementById('timetablePage').innerHTML = html;
                
                // Add event listeners
                document.getElementById('addTimetableBtn').addEventListener('click', () => {
                    this.showTimetableForm();
                });
            }
            
            showTimetableForm(timetableId = null) {
                let timetable = null;
                if (timetableId) {
                    const timetables = storage.getTimetable();
                    timetable = timetables.find(t => t.id === timetableId);
                }
                
                const classes = storage.getClasses();
                const subjects = storage.getSubjects();
                
                const html = `
                    <div class="modal-overlay" id="timetableFormModal">
                        <div class="modal" style="max-width: 800px;">
                            <div class="modal-header">
                                <h3 class="modal-title">${timetable ? 'Edit Timetable' : 'Create Timetable'}</h3>
                                <button class="modal-close" id="closeTimetableForm">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="timetableForm">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">Class *</label>
                                            <select class="form-control" name="class" required>
                                                <option value="">Select Class</option>
                                                ${classes.map(cls => `
                                                    <option value="${cls.name.replace('Class ', '')}" ${timetable?.class == cls.name.replace('Class ', '') ? 'selected' : ''}>${cls.name}</option>
                                                `).join('')}
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Section *</label>
                                            <select class="form-control" name="section" required>
                                                <option value="">Select Section</option>
                                                ${['A','B','C','D','E'].map(sec => `
                                                    <option value="${sec}" ${timetable?.section === sec ? 'selected' : ''}>Section ${sec}</option>
                                                `).join('')}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div id="timetableDays">
                                        ${timetable && timetable.periods ? timetable.periods.map((period, index) => `
                                            <div class="card" style="margin-bottom: 1rem;">
                                                <div class="card-header">
                                                    <h4 class="card-title">Day ${index + 1}</h4>
                                                    <button type="button" class="btn btn-sm btn-danger" onclick="ui.removeTimetableDay(${index})">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <div style="padding: 1rem;">
                                                    <div class="form-group">
                                                        <label class="form-label">Day Name</label>
                                                        <input type="text" class="form-control" name="day${index}" value="${period.day || ''}" placeholder="e.g., Monday">
                                                    </div>
                                                    <div class="form-row">
                                                        ${[1,2,3,4,5,6,7].map(periodNum => `
                                                            <div class="form-group">
                                                                <label class="form-label">Period ${periodNum}</label>
                                                                <select class="form-control" name="period${index}_${periodNum}">
                                                                    <option value="">Free</option>
                                                                    ${subjects.map(subject => `
                                                                        <option value="${subject.name}" ${period['period' + periodNum] === subject.name ? 'selected' : ''}>${subject.name}</option>
                                                                    `).join('')}
                                                                </select>
                                                            </div>
                                                        `).join('')}
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('') : ''}
                                    </div>
                                    
                                    <div style="text-align: center; margin: 1.5rem 0;">
                                        <button type="button" class="btn btn-secondary" id="addTimetableDayBtn">
                                            <i class="fas fa-plus"></i> Add Day
                                        </button>
                                    </div>
                                    
                                    ${timetable ? `<input type="hidden" name="id" value="${timetable.id}">` : ''}
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="cancelTimetableForm">Cancel</button>
                                <button class="btn btn-primary" id="saveTimetable">${timetable ? 'Update' : 'Save'} Timetable</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Initialize day counter
                this.timetableDayCount = timetable ? timetable.periods.length : 0;
                
                // Add event listeners
                document.getElementById('closeTimetableForm').addEventListener('click', () => {
                    document.getElementById('timetableFormModal').remove();
                });
                
                document.getElementById('cancelTimetableForm').addEventListener('click', () => {
                    document.getElementById('timetableFormModal').remove();
                });
                
                document.getElementById('addTimetableDayBtn').addEventListener('click', () => {
                    this.addTimetableDay();
                });
                
                document.getElementById('saveTimetable').addEventListener('click', () => {
                    this.saveTimetable();
                });
                
                // If no days exist, add one by default
                if (!timetable || !timetable.periods || timetable.periods.length === 0) {
                    this.addTimetableDay();
                }
            }
            
            addTimetableDay() {
                const subjects = storage.getSubjects();
                const dayIndex = this.timetableDayCount;
                
                const dayHtml = `
                    <div class="card" style="margin-bottom: 1rem;">
                        <div class="card-header">
                            <h4 class="card-title">Day ${dayIndex + 1}</h4>
                            <button type="button" class="btn btn-sm btn-danger" onclick="ui.removeTimetableDay(${dayIndex})">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div style="padding: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Day Name</label>
                                <input type="text" class="form-control" name="day${dayIndex}" placeholder="e.g., Monday">
                            </div>
                            <div class="form-row">
                                ${[1,2,3,4,5,6,7].map(periodNum => `
                                    <div class="form-group">
                                        <label class="form-label">Period ${periodNum}</label>
                                        <select class="form-control" name="period${dayIndex}_${periodNum}">
                                            <option value="">Free</option>
                                            ${subjects.map(subject => `
                                                <option value="${subject.name}">${subject.name}</option>
                                            `).join('')}
                                        </select>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('timetableDays').insertAdjacentHTML('beforeend', dayHtml);
                this.timetableDayCount++;
            }
            
            removeTimetableDay(index) {
                const dayElement = document.querySelector(`#timetableDays .card:nth-child(${index + 1})`);
                if (dayElement) {
                    dayElement.remove();
                    // Re-index remaining days
                    const days = document.querySelectorAll('#timetableDays .card');
                    days.forEach((day, i) => {
                        const title = day.querySelector('.card-title');
                        if (title) {
                            title.textContent = `Day ${i + 1}`;
                        }
                    });
                    this.timetableDayCount = days.length;
                }
            }
            
            saveTimetable() {
                const form = document.getElementById('timetableForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                
                const timetable = {
                    class: data.class,
                    section: data.section,
                    periods: []
                };
                
                if (data.id) {
                    timetable.id = data.id;
                }
                
                // Collect period data
                const days = document.querySelectorAll('#timetableDays .card');
                days.forEach((day, index) => {
                    const dayName = formData.get(`day${index}`);
                    if (dayName) {
                        const periodData = { day: dayName };
                        
                        // Get period subjects
                        for (let i = 1; i <= 7; i++) {
                            const subject = formData.get(`period${index}_${i}`);
                            if (subject) {
                                periodData[`period${i}`] = subject;
                            }
                        }
                        
                        timetable.periods.push(periodData);
                    }
                });
                
                if (timetable.periods.length === 0) {
                    this.showToast({ type: 'error', message: 'Please add at least one day to the timetable' });
                    return;
                }
                
                storage.saveTimetable(timetable);
                document.getElementById('timetableFormModal').remove();
                
                this.showToast({
                    type: 'success',
                    message: `Timetable ${timetable.id ? 'updated' : 'created'} successfully`
                });
                
                // Reload current page
                this.loadPageContent(this.currentPage);
            }
            
            showTimetable(timetableId) {
                const timetables = storage.getTimetable();
                const timetable = timetables.find(t => t.id === timetableId);
                
                if (!timetable) return;
                
                let timetableHtml = '';
                
                if (timetable.periods && timetable.periods.length > 0) {
                    timetableHtml = `
                        <table class="timetable">
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    ${[1,2,3,4,5,6,7].map(p => `<th>Period ${p}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${timetable.periods.map(period => `
                                    <tr>
                                        <td class="timetable-period">${period.day}</td>
                                        ${[1,2,3,4,5,6,7].map(p => `
                                            <td>
                                                ${period[`period${p}`] ? `
                                                    <div class="timetable-subject">${period[`period${p}`]}</div>
                                                ` : 'Free'}
                                            </td>
                                        `).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                } else {
                    timetableHtml = '<p>No timetable data available.</p>';
                }
                
                const html = `
                    <div class="modal-overlay" id="timetableModal">
                        <div class="modal" style="max-width: 900px;">
                            <div class="modal-header">
                                <h3 class="modal-title">Timetable - Class ${timetable.class} - Section ${timetable.section}</h3>
                                <button class="modal-close" id="closeTimetableModal">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                ${timetableHtml}
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="closeTimetableBtn">Close</button>
                                <button class="btn btn-primary" onclick="ui.showTimetableForm('${timetable.id}')">
                                    <i class="fas fa-edit"></i> Edit Timetable
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                // Add event listeners
                document.getElementById('closeTimetableModal').addEventListener('click', () => {
                    document.getElementById('timetableModal').remove();
                });
                
                document.getElementById('closeTimetableBtn').addEventListener('click', () => {
                    document.getElementById('timetableModal').remove();
                });
            }
            
            deleteTimetable(timetableId) {
                if (confirm('Are you sure you want to delete this timetable?')) {
                    storage.deleteTimetable(timetableId);
                    this.showToast({ type: 'success', message: 'Timetable deleted successfully' });
                    this.loadPageContent(this.currentPage);
                }
            }
            
            loadNotices() {
                const notices = storage.getNotices();
                
                const html = `
                    <div class="page-header">
                        <h1 class="page-title">Notice Board</h1>
                        <div class="page-actions">
                            <button class="btn btn-primary" id="addNoticeBtn">
                                <i class="fas fa-plus"></i> Add Notice
                            </button>
                        </div>
                    </div>
                    
                    <div class="notices-list" id="noticesList">
                        ${notices.map(notice => `
                            <div class="notice-card ${notice.important ? 'important' : ''} ${notice.type === 'warning' ? 'warning' : ''}">
                                <div class="notice-header">
                                    <h4 class="notice-title">${notice.title}</h4>
                                    <div style="display: flex; gap: 1rem; align-items: center;">
                                        <span class="notice-date">${new Date(notice.date).toLocaleDateString()}</span>
                                        <div style="display: flex; gap: 0.3rem;">
                                            <button class="btn btn-sm btn-primary" onclick="ui.editNotice('${notice.id}')">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="ui.deleteNotice('${notice.id}')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="notice-content">
                                    ${notice.content}
                                </div>
                                ${notice.important ? `<div style="margin-top: 1rem; color: var(--danger-color);">
                                    <i class="fas fa-exclamation-circle"></i> Important Notice
                                </div>` : ''}
                            </div>
                        `).join('')}
                        
                        ${notices.length === 0 ? `
                            <div class="card" style="text-align: center; padding: 3rem;">
                                <h3>No Notices Yet</h3>
                                <p>Click "Add Notice" to create your first notice.</p>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                document.getElementById('noticesPage').innerHTML = html;
                
                document.getElementById('addNoticeBtn').addEventListener('click', () => {
                    this.showNoticeForm();
                });
            }
            
            showNoticeForm(noticeId = null) {
                let notice = null;
                if (noticeId) {
                    const notices = storage.getNotices();
                    notice = notices.find(n => n.id === noticeId);
                }
                
                const html = `
                    <div class="modal-overlay" id="noticeFormModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3 class="modal-title">${notice ? 'Edit Notice' : 'Add New Notice'}</h3>
                                <button class="modal-close" id="closeNoticeForm">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="noticeForm">
                                    <div class="form-group">
                                        <label class="form-label">Notice Title *</label>
                                        <input type="text" class="form-control" name="title" value="${notice?.title || ''}" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Notice Content *</label>
                                        <textarea class="form-control" name="content" rows="6" required>${notice?.content || ''}</textarea>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label class="form-label">
                                                <input type="checkbox" name="important" ${notice?.important ? 'checked' : ''}>
                                                Mark as Important
                                            </label>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">
                                                <input type="checkbox" name="type" value="warning" ${notice?.type === 'warning' ? 'checked' : ''}>
                                                Mark as Warning
                                            </label>
                                        </div>
                                    </div>
                                    
                                    ${notice ? `<input type="hidden" name="id" value="${notice.id}">` : ''}
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="cancelNoticeForm">Cancel</button>
                                <button class="btn btn-primary" id="saveNotice">${notice ? 'Update' : 'Publish'} Notice</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                document.getElementById('closeNoticeForm').addEventListener('click', () => {
                    document.getElementById('noticeFormModal').remove();
                });
                
                document.getElementById('cancelNoticeForm').addEventListener('click', () => {
                    document.getElementById('noticeFormModal').remove();
                });
                
                document.getElementById('saveNotice').addEventListener('click', () => {
                    this.saveNotice();
                });
            }
            
            saveNotice() {
                const form = document.getElementById('noticeForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const formData = new FormData(form);
                const notice = Object.fromEntries(formData.entries());
                notice.important = formData.get('important') === 'on';
                notice.type = formData.get('type') === 'on' ? 'warning' : '';
                
                storage.saveNotice(notice);
                document.getElementById('noticeFormModal').remove();
                
                this.showToast({
                    type: 'success',
                    message: `Notice ${notice.id ? 'updated' : 'published'} successfully`
                });
                
                this.loadPageContent('notices');
            }
            
            editNotice(noticeId) {
                this.showNoticeForm(noticeId);
            }
            
            deleteNotice(noticeId) {
                if (confirm('Are you sure you want to delete this notice?')) {
                    storage.deleteNotice(noticeId);
                    this.showToast({ type: 'success', message: 'Notice deleted successfully' });
                    this.loadPageContent('notices');
                }
            }
            
            loadSettings() {
                const settings = storage.get('settings');
                
                const html = `
                    <div class="page-header">
                        <h1 class="page-title">System Settings</h1>
                    </div>
                    
                    <div class="settings-container">
                        <div class="settings-nav">
                            <ul>
                                <li><a href="#general" class="active" data-setting="general">General Settings</a></li>
                                <li><a href="#security" data-setting="security">Security</a></li>
                                <li><a href="#data" data-setting="data">Data Management</a></li>
                                <li><a href="#about" data-setting="about">About</a></li>
                            </ul>
                        </div>
                        
                        <div class="settings-content">
                            <div class="settings-section active" id="generalSettings">
                                <h3>General Settings</h3>
                                <form id="generalSettingsForm">
                                    <div class="form-group">
                                        <label class="form-label">School Name</label>
                                        <input type="text" class="form-control" name="schoolName" value="${settings.schoolName}">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Academic Year</label>
                                        <input type="text" class="form-control" name="academicYear" value="${settings.academicYear}">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Theme</label>
                                        <select class="form-control" name="theme">
                                            <option value="light" ${settings.theme === 'light' ? 'selected' : ''}>Light Mode</option>
                                            <option value="dark" ${settings.theme === 'dark' ? 'selected' : ''}>Dark Mode</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Default Date Format</label>
                                        <select class="form-control" name="dateFormat">
                                            <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                            <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                            <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                        </select>
                                    </div>
                                </form>
                                <button class="btn btn-primary" id="saveGeneralSettings">Save Changes</button>
                            </div>
                            
                            <div class="settings-section" id="securitySettings">
                                <h3>Security Settings</h3>
                                <div class="form-group">
                                    <label class="form-label">Change PIN</label>
                                    <input type="password" class="form-control" id="newPin" placeholder="Enter new 4-digit PIN" maxlength="4">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Confirm PIN</label>
                                    <input type="password" class="form-control" id="confirmPin" placeholder="Confirm new PIN" maxlength="4">
                                </div>
                                <button class="btn btn-primary" id="changePinBtn">Change PIN</button>
                                
                                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                                    <h4>Auto-lock Settings</h4>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <input type="checkbox" id="autoLock" checked>
                                            Auto-lock after 15 minutes of inactivity
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="settings-section" id="dataSettings">
                                <h3>Data Management</h3>
                                <div class="card" style="margin-bottom: 1.5rem;">
                                    <div style="padding: 1.5rem;">
                                        <h4>Export Data</h4>
                                        <p>Export all school data as a JSON backup file.</p>
                                        <button class="btn btn-primary" id="exportDataBtn">
                                            <i class="fas fa-download"></i> Export All Data
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="card" style="margin-bottom: 1.5rem;">
                                    <div style="padding: 1.5rem;">
                                        <h4>Import Data</h4>
                                        <p>Import data from a backup file. This will replace all current data.</p>
                                        <button class="btn btn-danger" id="importDataBtn">
                                            <i class="fas fa-upload"></i> Import & Replace Data
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <div style="padding: 1.5rem;">
                                        <h4>Clear All Data</h4>
                                        <p>Permanently delete all data from the system.</p>
                                        <button class="btn btn-danger" id="clearDataBtn">
                                            <i class="fas fa-trash"></i> Clear All Data
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="settings-section" id="aboutSettings">
                                <h3>About School ERP</h3>
                                <div class="card">
                                    <div style="padding: 1.5rem;">
                                        <h4>Offline School ERP System</h4>
                                        <p>Version 1.0.0</p>
                                        <p>A fully offline School Management System that works completely in your browser.</p>
                                        
                                        <h5 style="margin-top: 1.5rem;">Features:</h5>
                                        <ul>
                                            <li>Student Management</li>
                                            <li>Teacher Management</li>
                                            <li>Attendance Tracking</li>
                                            <li>Exam & Results</li>
                                            <li>Fee Management</li>
                                            <li>Timetable</li>
                                            <li>Notice Board</li>
                                            <li>Complete offline functionality</li>
                                            <li>Data backup & restore</li>
                                        </ul>
                                        
                                        <p style="margin-top: 1.5rem;">
                                            <strong>Note:</strong> All data is stored locally in your browser. 
                                            Make regular backups to prevent data loss.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('settingsPage').innerHTML = html;
                
                // Settings navigation
                document.querySelectorAll('.settings-nav a').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const setting = link.getAttribute('data-setting');
                        
                        // Update active nav link
                        document.querySelectorAll('.settings-nav a').forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                        
                        // Show active section
                        document.querySelectorAll('.settings-section').forEach(section => {
                            section.classList.remove('active');
                        });
                        document.getElementById(`${setting}Settings`).classList.add('active');
                    });
                });
                
                // Save general settings
                document.getElementById('saveGeneralSettings').addEventListener('click', () => {
                    const form = document.getElementById('generalSettingsForm');
                    const formData = new FormData(form);
                    const newSettings = Object.fromEntries(formData.entries());
                    
                    // Update settings
                    Object.assign(settings, newSettings);
                    storage.set('settings', settings);
                    
                    // Apply changes
                    document.getElementById('schoolName').textContent = settings.schoolName;
                    document.getElementById('academicYear').textContent = `Academic Year: ${settings.academicYear}`;
                    this.applyTheme();
                    
                    this.showToast({ type: 'success', message: 'Settings saved successfully' });
                });
                
                // Change PIN
                document.getElementById('changePinBtn').addEventListener('click', () => {
                    const newPin = document.getElementById('newPin').value;
                    const confirmPin = document.getElementById('confirmPin').value;
                    
                    if (!newPin || newPin.length !== 4) {
                        this.showToast({ type: 'error', message: 'PIN must be 4 digits' });
                        return;
                    }
                    
                    if (newPin !== confirmPin) {
                        this.showToast({ type: 'error', message: 'PINs do not match' });
                        return;
                    }
                    
                    settings.pin = newPin;
                    storage.set('settings', settings);
                    
                    document.getElementById('newPin').value = '';
                    document.getElementById('confirmPin').value = '';
                    
                    this.showToast({ type: 'success', message: 'PIN changed successfully' });
                });
                
                // Export data from settings
                document.getElementById('exportDataBtn').addEventListener('click', () => {
                    this.showExportModal();
                });
                
                // Import data from settings
                document.getElementById('importDataBtn').addEventListener('click', () => {
                    this.showImportModal();
                });
                
                // Clear all data
                document.getElementById('clearDataBtn').addEventListener('click', () => {
                    if (confirm('Are you sure you want to clear ALL data? This cannot be undone!')) {
                        if (confirm('This will delete ALL students, teachers, and all other data. Are you absolutely sure?')) {
                            localStorage.clear();
                            location.reload();
                        }
                    }
                });
            }
            
            showExportModal() {
                const html = `
                    <div class="modal-overlay" id="exportModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3 class="modal-title">Export Data</h3>
                                <button class="modal-close" id="closeExportModal">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Export All Data</h3>
                                        <div class="card-icon">
                                            <i class="fas fa-download"></i>
                                        </div>
                                    </div>
                                    <div style="padding: 1.5rem;">
                                        <p>This will export all School ERP data as a JSON file that can be imported later to restore your data.</p>
                                        <p><strong>File will include:</strong></p>
                                        <ul style="padding-left: 1.5rem; margin-bottom: 1.5rem;">
                                            <li>Students Data</li>
                                            <li>Teachers Data</li>
                                            <li>Classes & Subjects</li>
                                            <li>Attendance Records</li>
                                            <li>Exam Results</li>
                                            <li>Fee Records</li>
                                            <li>Timetable</li>
                                            <li>Notices</li>
                                            <li>System Settings</li>
                                        </ul>
                                        <p class="note" style="color: var(--warning-color);">
                                            <i class="fas fa-exclamation-triangle"></i> Keep this file safe and secure. It contains all your school data.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="cancelExport">Cancel</button>
                                <button class="btn btn-primary" id="confirmExport">
                                    <i class="fas fa-download"></i> Export Data
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                document.getElementById('closeExportModal').addEventListener('click', () => {
                    document.getElementById('exportModal').remove();
                });
                
                document.getElementById('cancelExport').addEventListener('click', () => {
                    document.getElementById('exportModal').remove();
                });
                
                document.getElementById('confirmExport').addEventListener('click', () => {
                    storage.exportData();
                    document.getElementById('exportModal').remove();
                    this.showToast({ type: 'success', message: 'Data exported successfully' });
                });
            }
            
            showImportModal() {
                const html = `
                    <div class="modal-overlay" id="importModal">
                        <div class="modal">
                            <div class="modal-header">
                                <h3 class="modal-title">Import Data</h3>
                                <button class="modal-close" id="closeImportModal">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Import Backup File</h3>
                                        <div class="card-icon">
                                            <i class="fas fa-upload"></i>
                                        </div>
                                    </div>
                                    <div style="padding: 1.5rem;">
                                        <p><strong>Warning:</strong> Importing data will replace ALL current data in the system.</p>
                                        <p>This action cannot be undone. Make sure you have exported your current data first if you want to keep it.</p>
                                        
                                        <div class="form-group" style="margin-top: 1.5rem;">
                                            <label class="form-label">Select Backup File (.json)</label>
                                            <input type="file" class="form-control" id="backupFile" accept=".json">
                                        </div>
                                        
                                        <p class="note" style="color: var(--danger-color); margin-top: 1rem;">
                                            <i class="fas fa-exclamation-circle"></i> All current data will be permanently replaced.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" id="cancelImport">Cancel</button>
                                <button class="btn btn-danger" id="confirmImport" disabled>
                                    <i class="fas fa-upload"></i> Import & Replace Data
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modalContainer').innerHTML = html;
                
                const fileInput = document.getElementById('backupFile');
                const confirmBtn = document.getElementById('confirmImport');
                
                fileInput.addEventListener('change', () => {
                    confirmBtn.disabled = !fileInput.files.length;
                });
                
                document.getElementById('closeImportModal').addEventListener('click', () => {
                    document.getElementById('importModal').remove();
                });
                
                document.getElementById('cancelImport').addEventListener('click', () => {
                    document.getElementById('importModal').remove();
                });
                
                confirmBtn.addEventListener('click', () => {
                    if (fileInput.files.length) {
                        if (confirm('Are you absolutely sure? This will replace ALL current data with the imported data.')) {
                            storage.importData(fileInput.files[0])
                                .then(() => {
                                    document.getElementById('importModal').remove();
                                    this.showToast({ type: 'success', message: 'Data imported successfully' });
                                    location.reload(); // Reload to apply imported data
                                })
                                .catch(error => {
                                    this.showToast({ type: 'error', message: `Import failed: ${error.message}` });
                                });
                        }
                    }
                });
            }
            
            filterTable(searchTerm, tableId, columnIndex = null) {
                const table = document.getElementById(tableId);
                if (!table) return;
                
                const rows = table.getElementsByTagName('tr');
                searchTerm = searchTerm.toLowerCase();
                
                for (let i = 1; i < rows.length; i++) { // Start from 1 to skip header
                    const cells = rows[i].getElementsByTagName('td');
                    let found = false;
                    
                    if (columnIndex !== null) {
                        // Search in specific column
                        if (cells.length > columnIndex) {
                            const cellText = cells[columnIndex].textContent || cells[columnIndex].innerText;
                            if (cellText.toLowerCase().includes(searchTerm)) {
                                found = true;
                            }
                        }
                    } else {
                        // Search in all columns
                        for (let j = 0; j < cells.length; j++) {
                            const cellText = cells[j].textContent || cells[j].innerText;
                            if (cellText.toLowerCase().includes(searchTerm)) {
                                found = true;
                                break;
                            }
                        }
                    }
                    
                    rows[i].style.display = found ? '' : 'none';
                }
            }
            
            initPagination(tableId, itemsPerPage) {
                const table = document.getElementById(tableId);
                if (!table) return;
                
                const rows = Array.from(table.querySelectorAll('tbody tr'));
                const totalPages = Math.ceil(rows.length / itemsPerPage);
                let currentPage = 1;
                
                const updatePagination = () => {
                    // Hide all rows
                    rows.forEach(row => {
                        row.style.display = 'none';
                    });
                    
                    // Show rows for current page
                    const start = (currentPage - 1) * itemsPerPage;
                    const end = start + itemsPerPage;
                    
                    for (let i = start; i < end && i < rows.length; i++) {
                        if (rows[i].style.display !== 'none') {
                            rows[i].style.display = '';
                        }
                    }
                    
                    // Update page numbers
                    const pageNumbers = document.getElementById('pageNumbers');
                    if (pageNumbers) {
                        let pageHtml = '';
                        for (let i = 1; i <= totalPages; i++) {
                            pageHtml += `
                                <button class="page-btn ${i === currentPage ? 'active' : ''}" data-page="${i}">
                                    ${i}
                                </button>
                            `;
                        }
                        pageNumbers.innerHTML = pageHtml;
                        
                        // Add event listeners to page buttons
                        pageNumbers.querySelectorAll('.page-btn').forEach(btn => {
                            btn.addEventListener('click', () => {
                                currentPage = parseInt(btn.getAttribute('data-page'));
                                updatePagination();
                            });
                        });
                    }
                    
                    // Update prev/next buttons
                    const prevBtn = document.getElementById('prevPage');
                    const nextBtn = document.getElementById('nextPage');
                    
                    if (prevBtn) {
                        prevBtn.disabled = currentPage === 1;
                        prevBtn.onclick = () => {
                            if (currentPage > 1) {
                                currentPage--;
                                updatePagination();
                            }
                        };
                    }
                    
                    if (nextBtn) {
                        nextBtn.disabled = currentPage === totalPages;
                        nextBtn.onclick = () => {
                            if (currentPage < totalPages) {
                                currentPage++;
                                updatePagination();
                            }
                        };
                    }
                };
                
                updatePagination();
            }
            
            showToast(toast) {
                const { type = 'info', message, duration = 3000 } = toast;
                
                const toastElement = document.createElement('div');
                toastElement.className = `toast ${type}`;
                toastElement.innerHTML = `
                    <div class="toast-icon">
                        ${type === 'success' ? '<i class="fas fa-check-circle"></i>' : 
                          type === 'error' ? '<i class="fas fa-exclamation-circle"></i>' :
                          type === 'warning' ? '<i class="fas fa-exclamation-triangle"></i>' :
                          '<i class="fas fa-info-circle"></i>'}
                    </div>
                    <div class="toast-message">${message}</div>
                    <button class="toast-close">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                document.getElementById('toastContainer').appendChild(toastElement);
                
                // Auto remove after duration
                setTimeout(() => {
                    if (toastElement.parentNode) {
                        toastElement.style.animation = 'slideInRight 0.3s ease reverse';
                        setTimeout(() => {
                            if (toastElement.parentNode) {
                                toastElement.remove();
                            }
                        }, 300);
                    }
                }, duration);
                
                // Close button
                toastElement.querySelector('.toast-close').addEventListener('click', () => {
                    toastElement.remove();
                });
            }
            
            exportTableToCSV(tableType) {
                let csv = [];
                let rows = [];
                
                switch(tableType) {
                    case 'students':
                        const students = storage.getStudents();
                        csv.push(['Admission No', 'Name', 'Class', 'Section', 'Roll No', 'Gender', 'DOB', 'Parent Name', 'Phone', 'Address']);
                        students.forEach(student => {
                            csv.push([
                                student.admissionNo,
                                student.name,
                                student.class,
                                student.section,
                                student.rollNo,
                                student.gender,
                                student.dob ? new Date(student.dob).toLocaleDateString() : '',
                                student.parentName,
                                student.phone,
                                student.address || ''
                            ]);
                        });
                        break;
                }
                
                // Convert to CSV string
                const csvString = csv.map(row => 
                    row.map(cell => `"${cell}"`).join(',')
                ).join('\n');
                
                // Create download link
                const blob = new Blob([csvString], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `students-export-${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showToast({ type: 'success', message: 'CSV exported successfully' });
            }
        }

        // Create global UI instance
        window.ui = new SchoolERPUI();
        window.showToast = (toast) => ui.showToast(toast);

        // ============================================
        // Main Application Initialization
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            // Check if system is locked
            const settings = storage.get('settings');
            const lockScreen = document.getElementById('lockScreen');
            const appContainer = document.getElementById('appContainer');
            
            // For demo purposes, auto-unlock. In production, you'd check PIN
            lockScreen.style.display = 'none';
            appContainer.style.display = 'flex';
            
            // Update storage usage
            storage.updateStorageUsage();
        });

        // Handle beforeunload to warn about data loss
        window.addEventListener('beforeunload', (e) => {
            // Only show warning if there's data
            const students = storage.getStudents();
            if (students.length > 0) {
                // Modern browsers require setting returnValue
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>